$hi[0] = "가규";
$hi[1] = "가범";
$hi[2] = "가충";
$hi[3] = "가화";
$hi[4] = "가후";
$hi[5] = "감녕";
$hi[6] = "감택";
$hi[7] = "강유";
$hi[8] = "건석";
$hi[9] = "견초";
$hi[10] = "견홍";
$hi[11] = "견희";
$hi[12] = "계옹";
$hi[13] = "고간";
$hi[14] = "고담";
$hi[15] = "고당륭";
$hi[16] = "고람";
$hi[17] = "고상";
$hi[18] = "고순";
$hi[19] = "고승";
$hi[20] = "고옹";
$hi[21] = "고유";
$hi[22] = "고정";
$hi[23] = "고패";
$hi[24] = "공구";
$hi[25] = "공도";
$hi[26] = "공손강";
$hi[27] = "공손공";
$hi[28] = "공손도";
$hi[29] = "공손범";
$hi[30] = "공손속";
$hi[31] = "공손연";
$hi[32] = "공손월";
$hi[33] = "공손찬";
$hi[34] = "공융";
$hi[35] = "공주";
$hi[36] = "공지";
$hi[37] = "곽가";
$hi[38] = "곽도";
$hi[39] = "곽마";
$hi[40] = "곽사";
$hi[41] = "곽원";
$hi[42] = "곽유지";
$hi[43] = "곽익";
$hi[44] = "곽준";
$hi[45] = "곽혁";
$hi[46] = "곽회";
$hi[47] = "관로";
$hi[48] = "관색";
$hi[49] = "관우";
$hi[50] = "관이";
$hi[51] = "관정";
$hi[52] = "관통";
$hi[53] = "관평";
$hi[54] = "관해";
$hi[55] = "관흥";
$hi[56] = "괴량";
$hi[57] = "괴월";
$hi[58] = "교모";
$hi[59] = "교유";
$hi[60] = "교현";
$hi[61] = "구건";
$hi[62] = "구본";
$hi[63] = "구성";
$hi[64] = "국연";
$hi[65] = "국의";
$hi[66] = "극정";
$hi[67] = "금선";
$hi[68] = "금의";
$hi[69] = "금환삼결";
$hi[70] = "기령";
$hi[71] = "낙통";
$hi[72] = "남두";
$hi[73] = "냉포";
$hi[74] = "노숙";
$hi[75] = "뇌박";
$hi[76] = "누규";
$hi[77] = "능조";
$hi[78] = "능통";
$hi[79] = "단경";
$hi[80] = "담웅";
$hi[81] = "당균";
$hi[82] = "당빈";
$hi[83] = "당자";
$hi[84] = "대교";
$hi[85] = "대래동주";
$hi[86] = "대릉";
$hi[87] = "도겸";
$hi[88] = "도준";
$hi[89] = "동궐";
$hi[90] = "동도나";
$hi[91] = "동민";
$hi[92] = "동소";
$hi[93] = "동습";
$hi[94] = "동승";
$hi[95] = "동윤";
$hi[96] = "동조";
$hi[97] = "동탁";
$hi[98] = "동화";
$hi[99] = "두기";
$hi[100] = "두예";
$hi[101] = "등무";
$hi[102] = "등수";
$hi[103] = "등애";
$hi[104] = "등윤";
$hi[105] = "등지";
$hi[106] = "등충";
$hi[107] = "등현";
$hi[108] = "라헌";
$hi[109] = "마균";
$hi[110] = "마대";
$hi[111] = "마등";
$hi[112] = "마량";
$hi[113] = "마막";
$hi[114] = "마속";
$hi[115] = "마완";
$hi[116] = "마운령";
$hi[117] = "마준";
$hi[118] = "마철";
$hi[119] = "마초";
$hi[120] = "마충";
$hi[121] = "마휴";
$hi[122] = "마욱";
$hi[123] = "만총";
$hi[124] = "망아장";
$hi[125] = "맹달";
$hi[126] = "맹우";
$hi[127] = "맹종";
$hi[128] = "맹획";
$hi[129] = "목록대왕";
$hi[130] = "목순";
$hi[131] = "관구검";
$hi[132] = "관구수";
$hi[133] = "관구전";
$hi[134] = "무안국";
$hi[135] = "문빙";
$hi[136] = "문앙";
$hi[137] = "문추";
$hi[138] = "문호";
$hi[139] = "문흠";
$hi[140] = "미방";
$hi[141] = "미축";
$hi[142] = "반봉";
$hi[143] = "반장";
$hi[144] = "반준";
$hi[145] = "방덕";
$hi[146] = "방열";
$hi[147] = "방의";
$hi[148] = "방통";
$hi[149] = "방회";
$hi[150] = "배수";
$hi[151] = "배원소";
$hi[152] = "번건";
$hi[153] = "번능";
$hi[154] = "번조";
$hi[155] = "법정";
$hi[156] = "변희";
$hi[157] = "보즐";
$hi[158] = "보철";
$hi[159] = "보협";
$hi[160] = "복양흥";
$hi[161] = "봉기";
$hi[162] = "부동";
$hi[163] = "부사인";
$hi[164] = "부손";
$hi[165] = "부첨";
$hi[166] = "부하";
$hi[167] = "북두";
$hi[168] = "비시";
$hi[169] = "비연";
$hi[170] = "비요";
$hi[171] = "비의";
$hi[172] = "사마가";
$hi[173] = "사마랑";
$hi[174] = "사마망";
$hi[175] = "사마부";
$hi[176] = "사마사";
$hi[177] = "사마소";
$hi[178] = "사마염";
$hi[179] = "사마유";
$hi[180] = "사마의";
$hi[181] = "사마주";
$hi[182] = "사마휘";
$hi[183] = "사정";
$hi[184] = "사찬";
$hi[185] = "서막";
$hi[186] = "서서";
$hi[187] = "서성";
$hi[188] = "서영";
$hi[189] = "서질";
$hi[190] = "서황";
$hi[191] = "석포";
$hi[192] = "설옥";
$hi[193] = "설종";
$hi[194] = "설후";
$hi[195] = "성공영";
$hi[196] = "성만";
$hi[197] = "성의";
$hi[198] = "소교";
$hi[199] = "소비";
$hi[200] = "소유";
$hi[201] = "소제";
$hi[202] = "손건";
$hi[203] = "손견";
$hi[204] = "손관";
$hi[205] = "손광";
$hi[206] = "손교";
$hi[207] = "손권";
$hi[208] = "손기";
$hi[209] = "손노반";
$hi[210] = "손등";
$hi[211] = "손랑";
$hi[212] = "손량";
$hi[213] = "손례";
$hi[214] = "손빈";
$hi[215] = "손상향";
$hi[216] = "손소";
$hi[217] = "손수";
$hi[218] = "손유";
$hi[219] = "손이";
$hi[220] = "손익";
$hi[221] = "손정";
$hi[222] = "손준";
$hi[223] = "손중";
$hi[224] = "손진";
$hi[225] = "손책";
$hi[226] = "손침";
$hi[227] = "손호";
$hi[228] = "손화";
$hi[229] = "손환";
$hi[230] = "손휴";
$hi[231] = "손흠";
$hi[232] = "송겸";
$hi[233] = "송헌";
$hi[234] = "순심";
$hi[235] = "순우경";
$hi[236] = "순욱";
$hi[237] = "순유";
$hi[238] = "순의";
$hi[239] = "시삭";
$hi[240] = "신비";
$hi[241] = "신의";
$hi[242] = "신창";
$hi[243] = "신탐";
$hi[244] = "신평";
$hi[245] = "신헌영";
$hi[246] = "심배";
$hi[247] = "아회남";
$hi[248] = "악림";
$hi[249] = "악의";
$hi[250] = "악진";
$hi[251] = "악취";
$hi[252] = "악환";
$hi[253] = "안량";
$hi[254] = "양강";
$hi[255] = "양백";
$hi[256] = "양봉";
$hi[257] = "양부";
$hi[258] = "양서";
$hi[259] = "양송";
$hi[260] = "양수";
$hi[261] = "양습";
$hi[262] = "양앙";
$hi[263] = "양의";
$hi[264] = "양임";
$hi[265] = "양제";
$hi[266] = "양조";
$hi[267] = "양추";
$hi[268] = "양축";
$hi[269] = "양호";
$hi[270] = "양홍";
$hi[271] = "양흔";
$hi[272] = "양흥";
$hi[273] = "엄강";
$hi[274] = "엄백호";
$hi[275] = "엄안";
$hi[276] = "엄여";
$hi[277] = "엄정";
$hi[278] = "엄준";
$hi[279] = "여개";
$hi[280] = "여거";
$hi[281] = "여건";
$hi[282] = "여광";
$hi[283] = "여대";
$hi[284] = "여령기";
$hi[285] = "여몽";
$hi[286] = "여범";
$hi[287] = "여상";
$hi[288] = "여식";
$hi[289] = "여위황";
$hi[290] = "여포";
$hi[291] = "염상";
$hi[292] = "염우";
$hi[293] = "염유";
$hi[294] = "염포";
$hi[295] = "염행";
$hi[296] = "영제";
$hi[297] = "예형";
$hi[298] = "오강";
$hi[299] = "오거";
$hi[300] = "오경";
$hi[301] = "오국태";
$hi[302] = "오란";
$hi[303] = "오반";
$hi[304] = "오언";
$hi[305] = "오연";
$hi[306] = "오의";
$hi[307] = "오질";
$hi[308] = "오찬";
$hi[309] = "온회";
$hi[310] = "올돌골";
$hi[311] = "옹개";
$hi[312] = "왕경";
$hi[313] = "왕광";
$hi[314] = "왕기";
$hi[315] = "왕도";
$hi[316] = "왕돈";
$hi[317] = "왕랑";
$hi[318] = "왕루";
$hi[319] = "왕릉";
$hi[320] = "왕문";
$hi[321] = "왕보";
$hi[322] = "왕상";
$hi[323] = "왕수";
$hi[324] = "왕숙";
$hi[325] = "왕쌍";
$hi[326] = "왕업";
$hi[327] = "왕위";
$hi[328] = "왕윤";
$hi[329] = "왕융";
$hi[330] = "왕이";
$hi[331] = "왕준";
$hi[332] = "왕찬";
$hi[333] = "왕창";
$hi[334] = "왕충";
$hi[335] = "왕평";
$hi[336] = "왕항";
$hi[337] = "왕혼";
$hi[338] = "요립";
$hi[339] = "요화";
$hi[340] = "우금";
$hi[341] = "우길";
$hi[342] = "우번";
$hi[343] = "우보";
$hi[344] = "우사";
$hi[345] = "우전";
$hi[346] = "원담";
$hi[347] = "원상";
$hi[348] = "원소";
$hi[349] = "원술";
$hi[350] = "원요";
$hi[351] = "원유";
$hi[352] = "원윤";
$hi[353] = "원환";
$hi[354] = "원희";
$hi[355] = "위관";
$hi[356] = "위막";
$hi[357] = "위소";
$hi[358] = "위속";
$hi[359] = "위연";
$hi[360] = "위유";
$hi[361] = "위풍";
$hi[362] = "유괴";
$hi[363] = "유기";
$hi[364] = "유대";
$hi[365] = "유도";
$hi[366] = "유략";
$hi[367] = "유반";
$hi[368] = "유벽";
$hi[369] = "유복";
$hi[370] = "유봉";
$hi[371] = "유비";
$hi[372] = "유선";
$hi[373] = "유섭";
$hi[374] = "유소";
$hi[375] = "유순";
$hi[376] = "유승";
$hi[377] = "유심";
$hi[378] = "유언";
$hi[379] = "유엽";
$hi[380] = "유요";
$hi[381] = "유우";
$hi[382] = "유장";
$hi[383] = "유종";
$hi[384] = "유찬";
$hi[385] = "유파";
$hi[386] = "유평";
$hi[387] = "유표";
$hi[388] = "유현";
$hi[389] = "유화";
$hi[390] = "유훈";
$hi[391] = "육개";
$hi[392] = "육손";
$hi[393] = "육적";
$hi[394] = "육항";
$hi[395] = "윤대목";
$hi[396] = "윤묵";
$hi[397] = "윤상";
$hi[398] = "윤직";
$hi[399] = "이각";
$hi[400] = "이감";
$hi[401] = "이봉";
$hi[402] = "이부";
$hi[403] = "이성";
$hi[404] = "이숙";
$hi[405] = "이엄";
$hi[406] = "이유";
$hi[407] = "이이";
$hi[408] = "이적";
$hi[409] = "이전";
$hi[410] = "이통";
$hi[411] = "이회";
$hi[412] = "잠혼";
$hi[413] = "장각";
$hi[414] = "장간";
$hi[415] = "장개";
$hi[416] = "장굉";
$hi[417] = "장구";
$hi[418] = "장기";
$hi[419] = "장남";
$hi[420] = "장량";
$hi[421] = "장로";
$hi[422] = "장료";
$hi[423] = "장막";
$hi[424] = "장만성";
$hi[425] = "장반";
$hi[426] = "장보";
$hi[427] = "장비";
$hi[428] = "장빈";
$hi[429] = "장서";
$hi[430] = "장소";
$hi[431] = "장송";
$hi[432] = "장수";
$hi[433] = "장승";
$hi[434] = "장양";
$hi[435] = "장억";
$hi[436] = "장연";
$hi[437] = "장영";
$hi[438] = "장온";
$hi[439] = "장완";
$hi[440] = "장위";
$hi[441] = "장윤";
$hi[442] = "장의";
$hi[443] = "장의거";
$hi[444] = "장익";
$hi[445] = "장임";
$hi[446] = "장제";
$hi[447] = "장준";
$hi[448] = "장집";
$hi[449] = "장춘화";
$hi[450] = "장특";
$hi[451] = "장패";
$hi[452] = "장포";
$hi[453] = "장합";
$hi[454] = "장호";
$hi[455] = "장화";
$hi[456] = "장횡";
$hi[457] = "장훈";
$hi[458] = "장휴";
$hi[459] = "장흠";
$hi[460] = "저곡";
$hi[461] = "저수";
$hi[462] = "적방";
$hi[463] = "전기";
$hi[464] = "전단";
$hi[465] = "전만";
$hi[466] = "전상";
$hi[467] = "전속";
$hi[468] = "전역";
$hi[469] = "전예";
$hi[470] = "전위";
$hi[471] = "전의";
$hi[472] = "전종";
$hi[473] = "전주";
$hi[474] = "전풍";
$hi[475] = "전해";
$hi[476] = "정무";
$hi[477] = "정병";
$hi[478] = "정보";
$hi[479] = "정봉";
$hi[480] = "정욱";
$hi[481] = "정원";
$hi[482] = "정은";
$hi[483] = "정의";
$hi[484] = "정지원";
$hi[485] = "제갈각";
$hi[486] = "제갈교";
$hi[487] = "제갈균";
$hi[488] = "제갈근";
$hi[489] = "제갈량";
$hi[490] = "제갈상";
$hi[491] = "제갈서";
$hi[492] = "제갈정";
$hi[493] = "제갈첨";
$hi[494] = "제갈탄";
$hi[495] = "조루";
$hi[496] = "조모";
$hi[497] = "조무";
$hi[498] = "조방";
$hi[499] = "조범";
$hi[500] = "조비";
$hi[501] = "조상";
$hi[502] = "조성";
$hi[503] = "조순";
$hi[504] = "조식";
$hi[505] = "조앙";
$hi[506] = "조엄";
$hi[507] = "조예";
$hi[508] = "조우";
$hi[509] = "조운";
$hi[510] = "조웅";
$hi[511] = "조의";
$hi[512] = "조인";
$hi[513] = "조조";
$hi[514] = "조진";
$hi[515] = "조창";
$hi[516] = "조충";
$hi[517] = "조통";
$hi[518] = "조표";
$hi[519] = "조홍";
$hi[520] = "조환";
$hi[521] = "조훈";
$hi[522] = "조휴";
$hi[523] = "종요";
$hi[524] = "종육";
$hi[525] = "종이목";
$hi[526] = "종회";
$hi[527] = "좌자";
$hi[528] = "좌혁";
$hi[529] = "주거";
$hi[530] = "주방";
$hi[531] = "주앙";
$hi[532] = "주연";
$hi[533] = "주영";
$hi[534] = "주유";
$hi[535] = "주이";
$hi[536] = "주준";
$hi[537] = "주지";
$hi[538] = "주창";
$hi[539] = "주치";
$hi[540] = "주태";
$hi[541] = "주포";
$hi[542] = "주환";
$hi[543] = "주흔";
$hi[544] = "진건";
$hi[545] = "진교";
$hi[546] = "진군";
$hi[547] = "진궁";
$hi[548] = "진규";
$hi[549] = "진기";
$hi[550] = "진도";
$hi[551] = "진등";
$hi[552] = "진란";
$hi[553] = "진랑";
$hi[554] = "진림";
$hi[555] = "진무";
$hi[556] = "진복";
$hi[557] = "진수";
$hi[558] = "진식";
$hi[559] = "진응";
$hi[560] = "진진";
$hi[561] = "진태";
$hi[562] = "진표";
$hi[563] = "진횡";
$hi[564] = "차주";
$hi[565] = "착융";
$hi[566] = "채모";
$hi[567] = "채염";
$hi[568] = "채중";
$hi[569] = "채화";
$hi[570] = "초선";
$hi[571] = "초이";
$hi[572] = "초주";
$hi[573] = "초촉";
$hi[574] = "최림";
$hi[575] = "최염";
$hi[576] = "추단";
$hi[577] = "추정";
$hi[578] = "축융";
$hi[579] = "침옥";
$hi[580] = "타사대왕";
$hi[581] = "태사자";
$hi[582] = "태사향";
$hi[583] = "파재";
$hi[584] = "포삼낭";
$hi[585] = "포신";
$hi[586] = "포충";
$hi[587] = "풍습";
$hi[588] = "하식";
$hi[589] = "하안";
$hi[590] = "하의";
$hi[591] = "하제";
$hi[592] = "하진";
$hi[593] = "하후덕";
$hi[594] = "하후돈";
$hi[595] = "하후무";
$hi[596] = "하후상";
$hi[597] = "하후연";
$hi[598] = "하후영녀";
$hi[599] = "하후위";
$hi[600] = "하후은";
$hi[601] = "하후패";
$hi[602] = "하후현";
$hi[603] = "하후혜";
$hi[604] = "하후화";
$hi[605] = "학맹";
$hi[606] = "학소";
$hi[607] = "한거자";
$hi[608] = "한당";
$hi[609] = "한덕";
$hi[610] = "한복";
$hi[611] = "한섬";
$hi[612] = "한수";
$hi[613] = "한숭";
$hi[614] = "한윤";
$hi[615] = "한충";
$hi[616] = "한현";
$hi[617] = "한호";
$hi[618] = "향랑";
$hi[619] = "향총";
$hi[620] = "허공";
$hi[621] = "허소";
$hi[622] = "허유";
$hi[623] = "허의";
$hi[624] = "허저";
$hi[625] = "허정";
$hi[626] = "헌제";
$hi[627] = "형도영";
$hi[628] = "호반";
$hi[629] = "호분";
$hi[630] = "호열";
$hi[631] = "호제";
$hi[632] = "호준";
$hi[633] = "호진";
$hi[634] = "호질";
$hi[635] = "호차인";
$hi[636] = "화만";
$hi[637] = "화웅";
$hi[638] = "화타";
$hi[639] = "화핵";
$hi[640] = "화흠";
$hi[641] = "환계";
$hi[642] = "환범";
$hi[643] = "황개";
$hi[644] = "황권";
$hi[645] = "황보숭";
$hi[646] = "황숭";
$hi[647] = "황승언";
$hi[648] = "황월영";
$hi[649] = "황조";
$hi[650] = "황충";
$hi[651] = "황호";
$hi[652] = "후선";
$hi[653] = "후성";
$hi[654] = "휴고";
$hi[655] = "휴원진";
$hi[656] = "희지재";
$hi[657] = "강이식";
$hi[658] = "계백";
$hi[659] = "관창";
$hi[660] = "김유신";
$hi[661] = "김춘추";
$hi[662] = "소서노";
$hi[663] = "양만춘";
$hi[664] = "온달";
$hi[665] = "을지문덕";
$hi[666] = "평강";
$hi[667] = "주몽";
$hi[668] = "성채";
$hi[669] = "곽거병";
$hi[670] = "선화";
$hi[671] = "담덕";
$hi[672] = "흑치상지";
$hi[673] = "을두지";
$hi[674] = "온사문";
$hi[675] = "뇌음신";
$hi[676] = "이사부";
$hi[677] = "대조영";
$hi[678] = "선덕";
$hi[679] = "부영";
$hi[680] = "동백";
$hi[681] = "조민";
$hi[682] = "고선지";
$hi[683] = "검모잠";

sub QUEST_LINK {
							open(IN,"$QUEST_DATA");
							@QUEST_DATA = <IN>;
							close(IN);

							foreach(@QUEST_DATA){
							($qnum,$qcode,$qface,$qname,$qlevel,$quest,$qlimit,$qtalka,$qtalkb,$qtalkc,$qgold,$qrice,$qstr,$qint,$qlea,$qcha,$qcex,$qexp,$qseal,$qflag,$qcategory,$qrate,$qtalkd,$qup) = split(/<>/);
								if($kcodea =~ /$qcode/ && $qrate > rand(99)){
									if($qcategory =~ /상업/){
										if($qup =~ /상업/){
										$kqpoint += $zsyoadd;
										}else{
										$kqpoint += $qup;
										}
										if($qtalkd eq ""){
										}else{
										&K_LOG("$mmonth월 : $qtalkd");
										}
									}
								}
							}
}

sub CON_NUM{

	opendir(dirlist,"./charalog/main");
	while($file = readdir(dirlist)){
		if($file =~ /\.cgi/i){
			if(!open(page,"./charalog/main/$file")){
				&ERR2("파일 오픈 에러!");
			}
			@page = <page>;
			close(page);
			push(@CL_DATA,"@page<br>");
		}
	}
	closedir(dirlist);

	foreach(@CL_DATA) {
		($eid,$epass,$ename,$echara,$estr,$eint,$elea,$echa,$esol,$egat,$econ,$egold,$erice,$ecex,$eclass,$earm,$ebook,$ebank,$esub1,$esub2,$epos,$emes,$ehost,$edate,$email,$eos,$eskill,$epoint,$ect,$elevel,$eexp,$ecodea,$ecodeb,$eqpoint) = split(/<>/);

			if($in{'hcon'} eq $econ){
				$connum++;
			}


			if($cnum eq $econ){
				$connum1++;
			}
	}
}


sub DELETE {
	unlink("./charalog/main/$kid\.cgi");
	unlink("./charalog/log/$kid\.cgi");
	unlink("./charalog/log2/$kid\.cgi");
	unlink("./charalog/per/$kid\.cgi");
	unlink("./charalog/command/$kid\.cgi");
	unlink("./charalog/history/$kid\.cgi");
	next;
}

sub SKILL{

	if($eskillcode eq 'Aa'){
	$name = '농업';
	}
	if($eskillcode eq 'Ab'){
	$name = '거래';
	}
	if($eskillcode eq 'Ac'){
	$name = '덕망';
	}
	if($eskillcode eq 'Ba'){
	$name = '상업';
	}
	if($eskillcode eq 'Bb'){
	$name = '수완';
	}
	if($eskillcode eq 'Bc'){
	$name = '고용';
	}
	if($eskillcode eq 'Ca'){
	$name = '기술';
	}
	if($eskillcode eq 'Cb'){
	$name = '회피';
	}
	if($eskillcode eq 'Cc'){
	$name = '연구';
	}
	if($eskillcode eq 'Da'){
	$name = '양성';
	}
	if($eskillcode eq 'Db'){
	$name = '모병';
	}
	if($eskillcode eq 'Dc'){
	$name = '설치';
	}
	if($eskillcode eq 'Ea'){
	$name = '훈련';
	}
	if($eskillcode eq 'Eb'){
	$name = '독려';
	}
	if($eskillcode eq 'Ec'){
	$name = '원전';
	}
	if($eskillcode eq 'Fa'){
	$name = '민심';
	}
	if($eskillcode eq 'Fb'){
	$name = '매료';
	}
	if($eskillcode eq 'Fc'){
	$name = '매전';
	}
	if($eskillcode eq 'Ga'){
	$name = '고양';
	}
	if($eskillcode eq 'Gb'){
	$name = '병략';
	}
	if($eskillcode eq 'Gc'){
	$name = '일섬';
	}

}




sub JIDO0{

	for($i=1;$i<13;$i++){
		print "<TD width=20 bgcolor=$TD_C1>$i</TD>";
	}
	print "</TR>";
     for($i=0;$i<12;$i++){
		$n = $i+1;
		print "<TR><TD bgcolor=$TD_C3>$n</td>";
		for($j=0;$j<12;$j++){


				$m_hit=0;$zx=0;
				foreach(@TOWN_DATA){
					($zzname,$zzcon,$zznum,$zznou,$zzsyo,$zzshiro,$zznou_max,$zzsyo_max,$zzshiro_max,$zzpri,$zzx,$zzy,$zzsouba,$zzdef_att,$zzsub1,$zzsub2,$z[0],$z[1],$z[2],$z[3],$z[4],$z[5],$z[6],$z[7],$zzname1,$zzname2,$zzbong1,$zzbong2,$zzbong3)=split(/<>/);
	if($zzname2 eq "1"){
	$jiname ="평지";
	}elsif($zzname2 eq "2"){
	$jiname ="수상";
	}elsif($zzname2 eq "3"){
	$jiname ="산악";
	}


					if("$zzx" eq "$j" && "$zzy" eq "$i"){$m_hit=1;last;}
					$zx++;
				}
				$col="";
				if($m_hit){
					if($zx eq $kpos && ($zzname eq "성도" || $zzname eq "장안" || $zzname eq "양양" || $zzname eq "낙양" || $zzname eq "업" || $zzname eq "허창" || $zzname eq "건업" || $zzname eq "한")){
						if($kcon eq $zzcon){
						print "<TH bgcolor=$ELE_BG[$cou_ele[$zzcon]]><img src=$IMG/bg31.gif alt='$zzname【$cou_name[$zzcon]】
농민:$zznum
농업:$zznou/$zznou_max
상업:$zzsyo/$zzsyo_max
기술:$zzsub1/1200
민심:$zzpri
수비:$zzshiro/$zzshiro_max
방어:$zzdef_att/1000
시세:$zzsouba
지형:$jiname'></TH>";
						}else{
						print "<TH bgcolor=$ELE_BG[$cou_ele[$zzcon]]><img src=$IMG/bg31.gif alt=$zzname【$cou_name[$zzcon]】></TH>";
						}
					}elsif($zx eq $kpos && ($zzname eq "서량" || $zzname eq "천수" || $zzname eq "졸본" || $zzname eq "한중" || $zzname eq "강주" || $zzname eq "강하" || $zzname eq "장사" || $zzname eq "남해" || $zzname eq "진유" || $zzname eq "시상" || $zzname eq "초" || $zzname eq "단양" || $zzname eq "북평" || $zzname eq "회계" || $zzname eq "서라벌" || $zzname eq "사비")){
						if($kcon eq $zzcon){
						print "<TH bgcolor=$ELE_BG[$cou_ele[$zzcon]]><img src=$IMG/bg11.gif alt='$zzname【$cou_name[$zzcon]】
농민:$zznum
농업:$zznou/$zznou_max
상업:$zzsyo/$zzsyo_max
기술:$zzsub1/1200
민심:$zzpri
수비:$zzshiro/$zzshiro_max
방어:$zzdef_att/1000
시세:$zzsouba
지형:$jiname'></TH>";
						}else{
						print "<TH bgcolor=$ELE_BG[$cou_ele[$zzcon]]><img src=$IMG/bg11.gif alt=$zzname【$cou_name[$zzcon]】></TH>";
						}
					}elsif($zx eq $kpos && ($zzname eq "홍농" || $zzname eq "완" || $zzname eq "강릉" || $zzname eq "여남" || $zzname eq "복양" || $zzname eq "수춘" || $zzname eq "계" || $zzname eq "남피" || $zzname eq "북해" || $zzname eq "하비" || $zzname eq "광릉" || $zzname eq "오" || $zzname eq "국내")){
						if($kcon eq $zzcon){
						print "<TH bgcolor=$ELE_BG[$cou_ele[$zzcon]]><img src=$IMG/bg21.gif alt='$zzname【$cou_name[$zzcon]】
농민:$zznum
농업:$zznou/$zznou_max
상업:$zzsyo/$zzsyo_max
기술:$zzsub1/1200
민심:$zzpri
수비:$zzshiro/$zzshiro_max
방어:$zzdef_att/1000
시세:$zzsouba
지형:$jiname'></TH>";
						}else{
						print "<TH bgcolor=$ELE_BG[$cou_ele[$zzcon]]><img src=$IMG/bg21.gif alt=$zzname【$cou_name[$zzcon]】></TH>";
						}
					}elsif($zx eq $kpos && ($zzname eq "무도" || $zzname eq "건녕" || $zzname eq "상용" || $zzname eq "운남" || $zzname eq "안정" || $zzname eq "검각" || $zzname eq "자동" || $zzname eq "영안" || $zzname eq "무릉" || $zzname eq "영릉" || $zzname eq "신야" || $zzname eq "계양" || $zzname eq "평원" || $zzname eq "여강" || $zzname eq "소패" || $zzname eq "양평" || $zzname eq "매소")){
						if($kcon eq $zzcon){
						print "<TH bgcolor=$ELE_BG[$cou_ele[$zzcon]]><img src=$IMG/bg01.gif alt='$zzname【$cou_name[$zzcon]】
농민:$zznum
농업:$zznou/$zznou_max
상업:$zzsyo/$zzsyo_max
기술:$zzsub1/1200
민심:$zzpri
수비:$zzshiro/$zzshiro_max
방어:$zzdef_att/1000
시세:$zzsouba
지형:$jiname'></TH>";
						}else{
						print "<TH bgcolor=$ELE_BG[$cou_ele[$zzcon]]><img src=$IMG/bg01.gif alt=$zzname【$cou_name[$zzcon]】></TH>";
						}
					}elsif($zzname eq "성도" || $zzname eq "장안" || $zzname eq "양양" || $zzname eq "낙양" || $zzname eq "업" || $zzname eq "허창" || $zzname eq "건업" || $zzname eq "한"){
						if($kcon eq $zzcon){
						print "<TH bgcolor=$ELE_BG[$cou_ele[$zzcon]]><img src=$IMG/bg3.gif width=20 height=20 border=0 alt='$zzname【$cou_name[$zzcon]】
농민:$zznum
농업:$zznou/$zznou_max
상업:$zzsyo/$zzsyo_max
기술:$zzsub1/1200
민심:$zzpri
수비:$zzshiro/$zzshiro_max
방어:$zzdef_att/1000
시세:$zzsouba
지형:$jiname'></TH>";
						}else{
						print "<TH bgcolor=$ELE_BG[$cou_ele[$zzcon]]><img src=$IMG/bg3.gif width=20 height=20 border=0 alt=$zzname【$cou_name[$zzcon]】></TH>";
						}
					}elsif($zzname eq "홍농" || $zzname eq "완" || $zzname eq "강릉" || $zzname eq "여남" || $zzname eq "복양" || $zzname eq "수춘" || $zzname eq "계" || $zzname eq "남피" || $zzname eq "북해" || $zzname eq "하비" || $zzname eq "광릉" || $zzname eq "오" || $zzname eq "국내"){
						if($kcon eq $zzcon){
						print "<TH bgcolor=$ELE_BG[$cou_ele[$zzcon]]><img src=$IMG/bg2.gif width=20 height=20 border=0 alt='$zzname【$cou_name[$zzcon]】
농민:$zznum
농업:$zznou/$zznou_max
상업:$zzsyo/$zzsyo_max
기술:$zzsub1/1200
민심:$zzpri
수비:$zzshiro/$zzshiro_max
방어:$zzdef_att/1000
시세:$zzsouba
지형:$jiname'></TH>";
						}else{
						print "<TH bgcolor=$ELE_BG[$cou_ele[$zzcon]]><img src=$IMG/bg2.gif width=20 height=20 border=0 alt=$zzname【$cou_name[$zzcon]】></TH>";
						}
					}elsif($zzname eq "서량" || $zzname eq "천수" || $zzname eq "졸본" || $zzname eq "한중" || $zzname eq "강주" || $zzname eq "강하" || $zzname eq "장사" || $zzname eq "남해" || $zzname eq "진유" || $zzname eq "시상" || $zzname eq "초" || $zzname eq "단양" || $zzname eq "북평" || $zzname eq "회계" || $zzname eq "서라벌" || $zzname eq "사비"){
						if($kcon eq $zzcon){
						print "<TH bgcolor=$ELE_BG[$cou_ele[$zzcon]]><img src=$IMG/bg1.gif width=20 height=20 border=0 alt='$zzname【$cou_name[$zzcon]】
농민:$zznum
농업:$zznou/$zznou_max
상업:$zzsyo/$zzsyo_max
기술:$zzsub1/1200
민심:$zzpri
수비:$zzshiro/$zzshiro_max
방어:$zzdef_att/1000
시세:$zzsouba
지형:$jiname'></TH>";
						}else{
						print "<TH bgcolor=$ELE_BG[$cou_ele[$zzcon]]><img src=$IMG/bg1.gif width=20 height=20 border=0 alt=$zzname【$cou_name[$zzcon]】></TH>";
						}
					}elsif($zzname eq "1"){
						print "<TH img background=$IMG/sea.gif></TH>";
					}elsif($zzname eq "2"){
						print "<TH img background=$IMG/san.gif></TH>";
					}elsif($zzname eq "3"){
						print "<TH img background=$IMG/san1.gif></TH>";
					}elsif($zzname eq "4"){
						print "<TH img background=$IMG/hwang.gif></TH>";
					}elsif($zzname eq "5"){
						print "<TH img background=$IMG/cho.gif></TH>";
					}else{
						if($kcon eq $zzcon){
						print "<TH bgcolor=$ELE_BG[$cou_ele[$zzcon]]><img src=$IMG/bg0.gif width=20 height=20 border=0 alt='$zzname【$cou_name[$zzcon]】
농민:$zznum
농업:$zznou/$zznou_max
상업:$zzsyo/$zzsyo_max
기술:$zzsub1/1200
민심:$zzpri
수비:$zzshiro/$zzshiro_max
방어:$zzdef_att/1000
시세:$zzsouba
지형:$jiname'></TH>";
						}else{
						print "<TH bgcolor=$ELE_BG[$cou_ele[$zzcon]]><img src=$IMG/bg0.gif width=20 height=20 border=0 alt=$zzname【$cou_name[$zzcon]】></TH>";
						}
					}
				}else{
					print "<TH> </TH>";
				}
		}
		print "</TR>";
	}
}



sub JIDO1{
	for($i=1;$i<13;$i++){
		print "<TD width=20 bgcolor=$TD_C1>$i</TD>";
	}
	print "</TR>";
     for($i=0;$i<12;$i++){
		$n = $i+1;
		print "<TR><TD bgcolor=$TD_C3>$n</td>";
		for($j=0;$j<12;$j++){


				$m_hit=0;$zx=0;$good=-1;
				foreach(@TOWN_DATA){
					($zzname,$zzcon,$zznum,$zznou,$zzsyo,$zzshiro,$zznou_max,$zzsyo_max,$zzshiro_max,$zzpri,$zzx,$zzy,$zzsouba,$zzdef_att,$zzsub1,$zzsub2,$z[0],$z[1],$z[2],$z[3],$z[4],$z[5],$z[6],$z[7],$zzname1,$zzname2,$zzbong1,$zzbong2,$zzbong3)=split(/<>/);
					$good++;
	if($zzname2 eq "1"){
	$jiname ="평지";
	}elsif($zzname2 eq "2"){
	$jiname ="수상";
	}elsif($zzname2 eq "3"){
	$jiname ="산악";
	}


					if("$zzx" eq "$j" && "$zzy" eq "$i"){$m_hit=1;last;}
					$zx++;
				}
				$col="";
				if($m_hit){
					if($zx eq $kpos && ($zzname eq "성도" || $zzname eq "장안" || $zzname eq "양양" || $zzname eq "낙양" || $zzname eq "업" || $zzname eq "허창" || $zzname eq "건업" || $zzname eq "한")){
						if($kcon eq $zzcon){
						print "<TH bgcolor=$ELE_BG[$cou_ele[$zzcon]]><form action=$COMMAND method=POST>$no_list<input type=hidden name=id value=$kid><input type=hidden name=pass value=$kpass><input type=hidden name=mode value=$comlist><input type=hidden name=num value=$good><input type=image src=\"$IMG/bg31.gif\" alt='$zzname【$cou_name[$zzcon]】
농민:$zznum
농업:$zznou/$zznou_max
상업:$zzsyo/$zzsyo_max
기술:$zzsub1/1200
민심:$zzpri
수비:$zzshiro/$zzshiro_max
방어:$zzdef_att/1000
시세:$zzsouba
지형:$jiname'>
</TH></form>";
						}else{
						print "<TH bgcolor=$ELE_BG[$cou_ele[$zzcon]]><form action=$COMMAND method=POST><input type=hidden name=id value=$kid><input type=hidden name=pass value=$kpass><input type=hidden name=mode value=$comlist><input type=hidden name=num value=$good><input type=image src=\"$IMG/bg31.gif\" alt='$zzname【$cou_name[$zzcon]】'></TH></form>";
						}
					}elsif($zx eq $kpos && ($zzname eq "서량" || $zzname eq "천수" || $zzname eq "졸본" || $zzname eq "한중" || $zzname eq "강주" || $zzname eq "강하" || $zzname eq "장사" || $zzname eq "남해" || $zzname eq "진유" || $zzname eq "시상" || $zzname eq "초" || $zzname eq "단양" || $zzname eq "북평" || $zzname eq "회계" || $zzname eq "서라벌" || $zzname eq "사비")){
						if($kcon eq $zzcon){
						print "<TH bgcolor=$ELE_BG[$cou_ele[$zzcon]]><form action=$COMMAND method=POST>$no_list<input type=hidden name=id value=$kid><input type=hidden name=pass value=$kpass><input type=hidden name=mode value=$comlist><input type=hidden name=num value=$good><input type=image src=\"$IMG/bg11.gif\" alt='$zzname【$cou_name[$zzcon]】
농민:$zznum
농업:$zznou/$zznou_max
상업:$zzsyo/$zzsyo_max
기술:$zzsub1/1200
민심:$zzpri
수비:$zzshiro/$zzshiro_max
방어:$zzdef_att/1000
시세:$zzsouba
지형:$jiname'>
</TH></form>";
						}else{
						print "<TH bgcolor=$ELE_BG[$cou_ele[$zzcon]]><form action=$COMMAND method=POST>$no_list<input type=hidden name=id value=$kid><input type=hidden name=pass value=$kpass><input type=hidden name=mode value=$comlist><input type=hidden name=num value=$good><input type=image src=\"$IMG/bg11.gif\" alt='$zzname【$cou_name[$zzcon]】'></TH></form>";
						}
					}elsif($zx eq $kpos && ($zzname eq "홍농" || $zzname eq "완" || $zzname eq "강릉" || $zzname eq "여남" || $zzname eq "복양" || $zzname eq "수춘" || $zzname eq "계" || $zzname eq "남피" || $zzname eq "북해" || $zzname eq "하비" || $zzname eq "광릉" || $zzname eq "오" || $zzname eq "국내")){
						if($kcon eq $zzcon){
						print "<TH bgcolor=$ELE_BG[$cou_ele[$zzcon]]><form action=$COMMAND method=POST>$no_list<input type=hidden name=id value=$kid><input type=hidden name=pass value=$kpass><input type=hidden name=mode value=$comlist><input type=hidden name=num value=$good><input type=image src=\"$IMG/bg21.gif\" alt='$zzname【$cou_name[$zzcon]】
농민:$zznum
농업:$zznou/$zznou_max
상업:$zzsyo/$zzsyo_max
기술:$zzsub1/1200
민심:$zzpri
수비:$zzshiro/$zzshiro_max
방어:$zzdef_att/1000
시세:$zzsouba
지형:$jiname'>
</TH></form>";
						}else{
						print "<TH bgcolor=$ELE_BG[$cou_ele[$zzcon]]><form action=$COMMAND method=POST>$no_list<input type=hidden name=id value=$kid><input type=hidden name=pass value=$kpass><input type=hidden name=mode value=$comlist><input type=hidden name=num value=$good><input type=image src=\"$IMG/bg21.gif\" alt='$zzname【$cou_name[$zzcon]】'></TH></form>";
						}
					}elsif($zx eq $kpos && ($zzname eq "무도" || $zzname eq "건녕" || $zzname eq "운남" || $zzname eq "안정" || $zzname eq "검각" || $zzname eq "자동" || $zzname eq "영안" || $zzname eq "무릉" || $zzname eq "영릉" || $zzname eq "신야" || $zzname eq "계양" || $zzname eq "평원" || $zzname eq "여강" || $zzname eq "소패" || $zzname eq "양평" || $zzname eq "매소")){
						if($kcon eq $zzcon){
						print "<TH bgcolor=$ELE_BG[$cou_ele[$zzcon]]><form action=$COMMAND method=POST>$no_list<input type=hidden name=id value=$kid><input type=hidden name=pass value=$kpass><input type=hidden name=mode value=$comlist><input type=hidden name=num value=$good><input type=image src=\"$IMG/bg01.gif\" alt='$zzname【$cou_name[$zzcon]】
농민:$zznum
농업:$zznou/$zznou_max
상업:$zzsyo/$zzsyo_max
기술:$zzsub1/1200
민심:$zzpri
수비:$zzshiro/$zzshiro_max
방어:$zzdef_att/1000
시세:$zzsouba
지형:$jiname'>
</TH></form>";
						}else{
						print "<TH bgcolor=$ELE_BG[$cou_ele[$zzcon]]><form action=$COMMAND method=POST>$no_list<input type=hidden name=id value=$kid><input type=hidden name=pass value=$kpass><input type=hidden name=mode value=$comlist><input type=hidden name=num value=$good><input type=image src=\"$IMG/bg01.gif\" alt='$zzname【$cou_name[$zzcon]】'></TH></form>";
						}
					}elsif($zzname eq "성도" || $zzname eq "장안" || $zzname eq "양양" || $zzname eq "낙양" || $zzname eq "업" || $zzname eq "허창" || $zzname eq "건업" || $zzname eq "한"){
						if($kcon eq $zzcon){
						print "<TH bgcolor=$ELE_BG[$cou_ele[$zzcon]]><form action=$COMMAND method=POST>$no_list<input type=hidden name=id value=$kid><input type=hidden name=pass value=$kpass><input type=hidden name=mode value=$comlist><input type=hidden name=num value=$good><input type=image src=\"$IMG/bg3.gif\" alt='$zzname【$cou_name[$zzcon]】
농민:$zznum
농업:$zznou/$zznou_max
상업:$zzsyo/$zzsyo_max
기술:$zzsub1/1200
민심:$zzpri
수비:$zzshiro/$zzshiro_max
방어:$zzdef_att/1000
시세:$zzsouba
지형:$jiname'>
</TH></form>";
						}else{
						print "<TH bgcolor=$ELE_BG[$cou_ele[$zzcon]]><form action=$COMMAND method=POST>$no_list<input type=hidden name=id value=$kid><input type=hidden name=pass value=$kpass><input type=hidden name=mode value=$comlist><input type=hidden name=num value=$good><input type=image src=\"$IMG/bg3.gif\" alt='$zzname【$cou_name[$zzcon]】'></TH></form>";
						}
					}elsif($zzname eq "홍농" || $zzname eq "완" || $zzname eq "강릉" || $zzname eq "여남" || $zzname eq "복양" || $zzname eq "수춘" || $zzname eq "계" || $zzname eq "남피" || $zzname eq "북해" || $zzname eq "하비" || $zzname eq "광릉" || $zzname eq "오" || $zzname eq "국내"){
						if($kcon eq $zzcon){
						print "<TH bgcolor=$ELE_BG[$cou_ele[$zzcon]]><form action=$COMMAND method=POST>$no_list<input type=hidden name=id value=$kid><input type=hidden name=pass value=$kpass><input type=hidden name=mode value=$comlist><input type=hidden name=num value=$good><input type=image src=\"$IMG/bg2.gif\" alt='$zzname【$cou_name[$zzcon]】
농민:$zznum
농업:$zznou/$zznou_max
상업:$zzsyo/$zzsyo_max
기술:$zzsub1/1200
민심:$zzpri
수비:$zzshiro/$zzshiro_max
방어:$zzdef_att/1000
시세:$zzsouba
지형:$jiname'>
</TH></form>";
						}else{
						print "<TH bgcolor=$ELE_BG[$cou_ele[$zzcon]]><form action=$COMMAND method=POST>$no_list<input type=hidden name=id value=$kid><input type=hidden name=pass value=$kpass><input type=hidden name=mode value=$comlist><input type=hidden name=num value=$good><input type=image src=\"$IMG/bg2.gif\" alt='$zzname【$cou_name[$zzcon]】'></TH></form>";
						}
					}elsif($zzname eq "서량" || $zzname eq "천수" || $zzname eq "졸본" || $zzname eq "한중" || $zzname eq "강주" || $zzname eq "강하" || $zzname eq "장사" || $zzname eq "남해" || $zzname eq "진유" || $zzname eq "시상" || $zzname eq "초" || $zzname eq "단양" || $zzname eq "북평" || $zzname eq "회계" || $zzname eq "서라벌" || $zzname eq "사비"){
						if($kcon eq $zzcon){
						print "<TH bgcolor=$ELE_BG[$cou_ele[$zzcon]]><form action=$COMMAND method=POST>$no_list<input type=hidden name=id value=$kid><input type=hidden name=pass value=$kpass><input type=hidden name=mode value=$comlist><input type=hidden name=num value=$good><input type=image src=\"$IMG/bg1.gif\" alt='$zzname【$cou_name[$zzcon]】
농민:$zznum
농업:$zznou/$zznou_max
상업:$zzsyo/$zzsyo_max
기술:$zzsub1/1200
민심:$zzpri
수비:$zzshiro/$zzshiro_max
방어:$zzdef_att/1000
시세:$zzsouba
지형:$jiname'>
</TH></form>";
						}else{
						print "<TH bgcolor=$ELE_BG[$cou_ele[$zzcon]]><form action=$COMMAND method=POST>$no_list<input type=hidden name=id value=$kid><input type=hidden name=pass value=$kpass><input type=hidden name=mode value=$comlist><input type=hidden name=num value=$good><input type=image src=\"$IMG/bg1.gif\" alt='$zzname【$cou_name[$zzcon]】'></TH></form>";
						}
					}elsif($zzname eq "1"){
						print "<TH img background=$IMG/sea.gif></TH>";
					}elsif($zzname eq "2"){
						print "<TH img background=$IMG/san.gif></TH>";
					}elsif($zzname eq "3"){
						print "<TH img background=$IMG/san1.gif></TH>";
					}elsif($zzname eq "4"){
						print "<TH img background=$IMG/hwang.gif></TH>";
					}elsif($zzname eq "5"){
						print "<TH img background=$IMG/cho.gif></TH>";
					}else{
						if($kcon eq $zzcon){
						print "<TH bgcolor=$ELE_BG[$cou_ele[$zzcon]]><form action=$COMMAND method=POST>$no_list<input type=hidden name=id value=$kid><input type=hidden name=pass value=$kpass><input type=hidden name=mode value=$comlist><input type=hidden name=num value=$good><input type=image src=\"$IMG/bg0.gif\" alt='$zzname【$cou_name[$zzcon]】
농민:$zznum
농업:$zznou/$zznou_max
상업:$zzsyo/$zzsyo_max
기술:$zzsub1/1200
민심:$zzpri
수비:$zzshiro/$zzshiro_max
방어:$zzdef_att/1000
시세:$zzsouba
지형:$jiname'>
</TH></form>";
						}else{
						print "<TH bgcolor=$ELE_BG[$cou_ele[$zzcon]]><form action=$COMMAND method=POST>$no_list<input type=hidden name=id value=$kid><input type=hidden name=pass value=$kpass><input type=hidden name=mode value=$comlist><input type=hidden name=num value=$good><input type=image src=\"$IMG/bg0.gif\" alt='$zzname【$cou_name[$zzcon]】'></TH></form>";
						}
					}
				}else{
					print "<TH> </TH>";
				}
		}
		print "</TR>";
	}
}

sub GWAN1{
	if($xking eq "$kid"){
		$rank_mes = "gg01";
	}elsif($x0 eq "$kid"){
		$rank_mes = "gg02";
	}elsif($x1 eq "$kid"){
		$rank_mes = "gg03";
	}elsif($x2 eq "$kid"){
		$rank_mes = "gg05";
	}elsif($x3 eq "$kid"){
		$rank_mes = "gg06";
	}elsif($x4 eq "$kid"){
		$rank_mes = "gg07";
	}elsif($x5 eq "$kid"){
		$rank_mes = "gg08";
	}elsif($x6 eq "$kid"){
		$rank_mes = "gg09";
	}elsif($x7 eq "$kid"){
		$rank_mes = "gg10";
	}elsif($x8 eq "$kid"){
		$rank_mes = "gg11";
	}elsif($x9 eq "$kid"){
		$rank_mes = "gg12";
	}elsif($x10 eq "$kid"){
		$rank_mes = "gg13";
	}elsif($x11 eq "$kid"){
		$rank_mes = "gg14";
	}elsif($x12 eq "$kid"){
		$rank_mes = "gg15";
	}elsif($x13 eq "$kid"){
		$rank_mes = "gg16";
	}elsif($x14 eq "$kid"){
		$rank_mes = "gg17";
	}elsif($x15 eq "$kid"){
		$rank_mes = "gg18";
	}elsif($x16 eq "$kid"){
		$rank_mes = "gg19";
	}elsif($x17 eq "$kid"){
		$rank_mes = "gg04";
	}elsif($x18 eq "$kid"){
		$rank_mes = "gg20";
	}elsif($x19 eq "$kid"){
		$rank_mes = "gg21";
	}elsif($x20 eq "$kid"){
		$rank_mes = "gg22";
	}elsif($x21 eq "$kid"){
		$rank_mes = "gg23";
	}elsif($x22 eq "$kid"){
		$rank_mes = "gg24";
	}elsif($x23 eq "$kid"){
		$rank_mes = "gg25";
	}elsif($x24 eq "$kid"){
		$rank_mes = "gg26";
	}elsif($x25 eq "$kid"){
		$rank_mes = "gg27";
	}elsif($x26 eq "$kid"){
		$rank_mes = "gg28";
	}else{$rank_mes="gg00";}

	$xsub = "$x0,$x1,$x2,$x3,$x4,$x5,$x6,$x7,$x8,$x9,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$xxsub1,$xxsub2,";
}

sub BONG_DEL{

	open(IN,"$UNIT_LIST") or &ERR("지정된 파일이 열리지 않습니다.");
	@UNI_DATA = <IN>;
	close(IN);

	$mhit=0;$hit=0;@NEW_UNI_DATA=();
	foreach(@UNI_DATA){
		($unit_id,$uunit_name,$ucon,$ureader,$uid,$uname,$uchara,$umes,$uflg)=split(/<>/);
		if("$uid" eq "$kid"){
			if($kid eq "$unit_id"){
				$mhit = 1;
				$mid = $unit_id;
			}elsif($kid eq "uid"){
			}
		}else{
			push(@NEW_UNI_DATA,"$_");
		}
	}

	if($mhit){
		@NEW_UNI_DATA=();
		foreach(@UNI_DATA){
			($unit_id,$uunit_name,$ucon,$ureader,$uid,$uname,$uchara,$umes,$uflg)=split(/<>/);
			if("$mid" eq "$unit_id"){
			}else{
				push(@NEW_UNI_DATA,"$_");
			}
		}
	}


	open(OUT,">$UNIT_LIST") or &ERR('UNIT3 새로운 데이터를 기입할 수 없습니다.');
	print OUT @NEW_UNI_DATA;
	close(OUT);

	open(IN,"$TOWN_LIST") or &ERR("지정된 파일이 열리지 않습니다.");
	@TOWN_DATA = <IN>;
	close(IN);

	$dkjf=0;
	foreach(@TOWN_DATA){
	($zname,$zcon,$znum,$znou,$zsyo,$zshiro,$znou_max,$zsyo_max,$zshiro_max,$zpri,$zx,$zy,$zsouba,$zdef_att,$zsub1,$zsub2,$z[0],$z[1],$z[2],$z[3],$z[4],$z[5],$z[6],$z[7],$zname1,$zname2,$zbong1,$zbong2,$zbong3)=split(/<>/);
			if($kid eq "$zbong1"){
			$zbong1 = "";
	splice(@TOWN_DATA,$dkjf,1,"$zname<>$zcon<>$znum<>$znou<>$zsyo<>$zshiro<>$znou_max<>$zsyo_max<>$zshiro_max<>$zpri<>$zx<>$zy<>$zsouba<>$zdef_att<>$zsub1<>$zsub2<>$z[0]<>$z[1]<>$z[2]<>$z[3]<>$z[4]<>$z[5]<>$z[6]<>$z[7]<>$zname1<>$zname2<>$zbong1<>$zbong2<>$zbong3<>\n");
	open(OUT,">$TOWN_LIST") or &ERR('TOWN 데이터를 기입할 수 없습니다.');
	print OUT @TOWN_DATA;
	close(OUT);
			}elsif($kid eq "$zbong2"){
			$zbong2 = "";
	splice(@TOWN_DATA,$dkjf,1,"$zname<>$zcon<>$znum<>$znou<>$zsyo<>$zshiro<>$znou_max<>$zsyo_max<>$zshiro_max<>$zpri<>$zx<>$zy<>$zsouba<>$zdef_att<>$zsub1<>$zsub2<>$z[0]<>$z[1]<>$z[2]<>$z[3]<>$z[4]<>$z[5]<>$z[6]<>$z[7]<>$zname1<>$zname2<>$zbong1<>$zbong2<>$zbong3<>\n");
	open(OUT,">$TOWN_LIST") or &ERR('TOWN 데이터를 기입할 수 없습니다.');
	print OUT @TOWN_DATA;
	close(OUT);
			}elsif($kid eq "$zbong3"){
			$zbong3 = "";
	splice(@TOWN_DATA,$dkjf,1,"$zname<>$zcon<>$znum<>$znou<>$zsyo<>$zshiro<>$znou_max<>$zsyo_max<>$zshiro_max<>$zpri<>$zx<>$zy<>$zsouba<>$zdef_att<>$zsub1<>$zsub2<>$z[0]<>$z[1]<>$z[2]<>$z[3]<>$z[4]<>$z[5]<>$z[6]<>$z[7]<>$zname1<>$zname2<>$zbong1<>$zbong2<>$zbong3<>\n");
	open(OUT,">$TOWN_LIST") or &ERR('TOWN 데이터를 기입할 수 없습니다.');
	print OUT @TOWN_DATA;
	close(OUT);
			}
	$dkjf++;
	}
}

sub GWAN2{
	if($xking ne ""){
		open(IN,"./charalog/main/$xking\.cgi");
		@E_DATA = <IN>;
		close(IN);
		($kingid,$kingpass,$king_name,$king_chara) = split(/<>/,$E_DATA[0]);
	}
	if($x0 ne ""){
		open(IN,"./charalog/main/$x0\.cgi");
		@E_DATA = <IN>;
		close(IN);
		($tid[0],$tpass[0],$tname[0],$tchara[0]) = split(/<>/,$E_DATA[0]);
		$ximg[0] = "$IMG/$tchara[0].gif";
	}
	if($x1 ne ""){
		open(IN,"./charalog/main/$x1\.cgi");
		@E_DATA = <IN>;
		close(IN);
		($tid[1],$tpass[1],$tname[1],$tchara[1]) = split(/<>/,$E_DATA[0]);
		$ximg[1] = "$IMG/$tchara[1].gif";
	}
	if($x2 ne ""){
		open(IN,"./charalog/main/$x2\.cgi");
		@E_DATA = <IN>;
		close(IN);
		($tid[2],$tpass[2],$tname[2],$tchara[2]) = split(/<>/,$E_DATA[0]);
		$ximg[2] = "$IMG/$tchara[2].gif";
	}
	if($x3 ne ""){
		open(IN,"./charalog/main/$x3\.cgi");
		@E_DATA = <IN>;
		close(IN);
		($tid[3],$tpass[3],$tname[3],$tchara[3]) = split(/<>/,$E_DATA[0]);
		$ximg[3] = "$IMG/$tchara[3].gif";
	}
	if($x4 ne ""){
		open(IN,"./charalog/main/$x4\.cgi");
		@E_DATA = <IN>;
		close(IN);
		($tid[4],$tpass[4],$tname[4],$tchara[4]) = split(/<>/,$E_DATA[0]);
		$ximg[4] = "$IMG/$tchara[4].gif";
	}
	if($x5 ne ""){
		open(IN,"./charalog/main/$x5\.cgi");
		@E_DATA = <IN>;
		close(IN);
		($tid[5],$tpass[5],$tname[5],$tchara[5]) = split(/<>/,$E_DATA[0]);
		$ximg[5] = "$IMG/$tchara[5].gif";
	}
	if($x6 ne ""){
		open(IN,"./charalog/main/$x6\.cgi");
		@E_DATA = <IN>;
		close(IN);
		($tid[6],$tpass[6],$tname[6],$tchara[6]) = split(/<>/,$E_DATA[0]);
		$ximg[6] = "$IMG/$tchara[6].gif";
	}

	if($x7 ne ""){
		open(IN,"./charalog/main/$x7\.cgi");
		@E_DATA = <IN>;
		close(IN);
		($tid[7],$tpass[7],$tname[7],$tchara[7]) = split(/<>/,$E_DATA[0]);
		$ximg[7] = "$IMG/$tchara[7].gif";
	}

	if($x8 ne ""){
		open(IN,"./charalog/main/$x8\.cgi");
		@E_DATA = <IN>;
		close(IN);
		($tid[8],$tpass[8],$tname[8],$tchara[8]) = split(/<>/,$E_DATA[0]);
		$ximg[8] = "$IMG/$tchara[8].gif";
	}

	if($x9 ne ""){
		open(IN,"./charalog/main/$x9\.cgi");
		@E_DATA = <IN>;
		close(IN);
		($tid[9],$tpass[9],$tname[9],$tchara[9]) = split(/<>/,$E_DATA[0]);
		$ximg[9] = "$IMG/$tchara[9].gif";
	}

	if($x10 ne ""){
		open(IN,"./charalog/main/$x10\.cgi");
		@E_DATA = <IN>;
		close(IN);
		($tid[10],$tpass[10],$tname[10],$tchara[10]) = split(/<>/,$E_DATA[0]);
		$ximg[10] = "$IMG/$tchara[10].gif";
	}

	if($x11 ne ""){
		open(IN,"./charalog/main/$x11\.cgi");
		@E_DATA = <IN>;
		close(IN);
		($tid[11],$tpass[11],$tname[11],$tchara[11]) = split(/<>/,$E_DATA[0]);
		$ximg[11] = "$IMG/$tchara[11].gif";
	}

	if($x12 ne ""){
		open(IN,"./charalog/main/$x12\.cgi");
		@E_DATA = <IN>;
		close(IN);
		($tid[12],$tpass[12],$tname[12],$tchara[12]) = split(/<>/,$E_DATA[0]);
		$ximg[12] = "$IMG/$tchara[12].gif";
	}

	if($x13 ne ""){
		open(IN,"./charalog/main/$x13\.cgi");
		@E_DATA = <IN>;
		close(IN);
		($tid[13],$tpass[13],$tname[13],$tchara[13]) = split(/<>/,$E_DATA[0]);
		$ximg[13] = "$IMG/$tchara[13].gif";
	}

	if($x14 ne ""){
		open(IN,"./charalog/main/$x14\.cgi");
		@E_DATA = <IN>;
		close(IN);
		($tid[14],$tpass[14],$tname[14],$tchara[14]) = split(/<>/,$E_DATA[0]);
		$ximg[14] = "$IMG/$tchara[14].gif";
	}

	if($x15 ne ""){
		open(IN,"./charalog/main/$x15\.cgi");
		@E_DATA = <IN>;
		close(IN);
		($tid[15],$tpass[15],$tname[15],$tchara[15]) = split(/<>/,$E_DATA[0]);
		$ximg[15] = "$IMG/$tchara[15].gif";
	}

	if($x16 ne ""){
		open(IN,"./charalog/main/$x16\.cgi");
		@E_DATA = <IN>;
		close(IN);
		($tid[16],$tpass[16],$tname[16],$tchara[16]) = split(/<>/,$E_DATA[0]);
		$ximg[16] = "$IMG/$tchara[16].gif";
	}

	if($x17 ne ""){
		open(IN,"./charalog/main/$x17\.cgi");
		@E_DATA = <IN>;
		close(IN);
		($tid[17],$tpass[17],$tname[17],$tchara[17]) = split(/<>/,$E_DATA[0]);
		$ximg[17] = "$IMG/$tchara[17].gif";
	}

	if($x18 ne ""){
		open(IN,"./charalog/main/$x18\.cgi");
		@E_DATA = <IN>;
		close(IN);
		($tid[18],$tpass[18],$tname[18],$tchara[18]) = split(/<>/,$E_DATA[0]);
		$ximg[18] = "$IMG/$tchara[18].gif";
	}

	if($x19 ne ""){
		open(IN,"./charalog/main/$x19\.cgi");
		@E_DATA = <IN>;
		close(IN);
		($tid[19],$tpass[19],$tname[19],$tchara[19]) = split(/<>/,$E_DATA[0]);
		$ximg[19] = "$IMG/$tchara[19].gif";
	}

	if($x20 ne ""){
		open(IN,"./charalog/main/$x20\.cgi");
		@E_DATA = <IN>;
		close(IN);
		($tid[20],$tpass[20],$tname[20],$tchara[20]) = split(/<>/,$E_DATA[0]);
		$ximg[20] = "$IMG/$tchara[20].gif";
	}
	if($x21 ne ""){
		open(IN,"./charalog/main/$x21\.cgi");
		@E_DATA = <IN>;
		close(IN);
		($tid[21],$tpass[21],$tname[21],$tchara[21]) = split(/<>/,$E_DATA[0]);
		$ximg[21] = "$IMG/$tchara[21].gif";
	}
	if($x22 ne ""){
		open(IN,"./charalog/main/$x22\.cgi");
		@E_DATA = <IN>;
		close(IN);
		($tid[22],$tpass[22],$tname[22],$tchara[22]) = split(/<>/,$E_DATA[0]);
		$ximg[22] = "$IMG/$tchara[22].gif";
	}
	if($x23 ne ""){
		open(IN,"./charalog/main/$x23\.cgi");
		@E_DATA = <IN>;
		close(IN);
		($tid[23],$tpass[23],$tname[23],$tchara[23]) = split(/<>/,$E_DATA[0]);
		$ximg[23] = "$IMG/$tchara[23].gif";
	}
	if($x24 ne ""){
		open(IN,"./charalog/main/$x24\.cgi");
		@E_DATA = <IN>;
		close(IN);
		($tid[24],$tpass[24],$tname[24],$tchara[24]) = split(/<>/,$E_DATA[0]);
		$ximg[24] = "$IMG/$tchara[24].gif";
	}
	if($x25 ne ""){
		open(IN,"./charalog/main/$x25\.cgi");
		@E_DATA = <IN>;
		close(IN);
		($tid[25],$tpass[25],$tname[25],$tchara[25]) = split(/<>/,$E_DATA[0]);
		$ximg[25] = "$IMG/$tchara[25].gif";
	}
	if($x26 ne ""){
		open(IN,"./charalog/main/$x26\.cgi");
		@E_DATA = <IN>;
		close(IN);
		($tid[26],$tpass[26],$tname[26],$tchara[26]) = split(/<>/,$E_DATA[0]);
		$ximg[26] = "$IMG/$tchara[26].gif";
	}
}


sub UNIT_DATA_OPEN {

	local($scon) = $_[0];
	open(IN,"condata/unit/$scon.dat");
	@UNIT_DATA = <IN>;
	close(IN);

	foreach(@UNIT_DATA){
		($uid,$ustatus,$uleader,$uname,$umes,$umember,$uline) = split(/<>/);
		$unit_name[$uid] = $uname."부대";
		$unit_leader[$uid] = $uleader;
		$unit_mes[$uid] = $umes;
	}
	$unit_name[0] = "재야";
}

sub CHARA_MAIN_OPEN2 {

	open(IN,"./charalog/main/$_[0].cgi") or &ERR2('ID와 패스워드가 올바르지는 않습니다.');
	@CN_DATA = <IN>;
	close(IN);

	($kid,$kpass,$kname,$kchara,$kstr,$kint,$klea,$kcha,$ksol,$kgat,$kcon,$kgold,$krice,$kcex,$kclass,$karm,$kbook,$kbank,$ksub1,$ksub2,$kpos,$kmes,$khost,$kdate,$kmail,$kos,$kskill,$kpoint,$kct,$klevel,$kexp,$kcodea,$kcodeb,$kqpoint) = split(/<>/,$CN_DATA[0]);

	$klank = &RANK_CHECK($kclass);

}



sub TOWN_DEF{
						($zname,$zcon,$znum,$znou,$zsyo,$zshiro,$znou_max,$zsyo_max,$zshiro_max,$zpri,$zx,$zy,$zsouba,$zdef_att,$zsub1,$zsub2,$z[0],$z[1],$z[2],$z[3],$z[4],$z[5],$z[6],$z[7],$zname1,$zname2,$zbong1,$zbong2,$zbong3)=split(/<>/,$TOWN_DATA[$kpos]);
						if($zdef_att< 200){
						$def_nums = 2;
						}
						if($zdef_att< 400){
						if($zdef_att>200){
						$def_nums = 3;}
						}
						if($zdef_att< 600){
						if($zdef_att>400){
						$def_nums = 4;}
						}
						if($zdef_att< 800){
						if($zdef_att>600){
						$def_nums = 5;}
						}
						if($zdef_att < 1001){
						if($zdef_att>800){
						$def_nums = 6;}
						}
}



sub HIS{
		if(($F_YEAR+$myear) eq "181" && $mmonth eq "1"){
			&MAP_LOG2("<img src=$IMG/j19.gif> [181년 1월]황자 협의 생모, 왕미인 독살당하다.");
		}
		if(($F_YEAR+$myear) eq "181" && $mmonth eq "9"){
			&MAP_LOG2("<img src=$IMG/j19.gif> [181년 9월]낭야 양도현에서 제갈량 출생하다.");
		}
		if(($F_YEAR+$myear) eq "182" && $mmonth eq "3"){
			&MAP_LOG2("<img src=$IMG/j19.gif> [182년 3월]손권, 오군 부춘(절강성)에서 출생하다.");
		}
		if(($F_YEAR+$myear) eq "184" && $mmonth eq "1"){
			&MAP_LOG2("<img src=$IMG/j19.gif> [184년 1월]중평(中平) 개원. 장각(張角), 황건적의 난을 일으킴.");
		}
		if(($F_YEAR+$myear) eq "184" && $mmonth eq "3"){
			&MAP_LOG2("<img src=$IMG/j19.gif> [184년 3월]유비,관우,장비 도원결의를 맺다.");
		}
		if(($F_YEAR+$myear) eq "189" && $mmonth eq "4"){
			&MAP_LOG2("<img src=$IMG/j19.gif> [189년 4월]광희(光喜) 개원. 영제 붕어, 소제(少帝) 유변(劉辯) 즉위.");
		}
		if(($F_YEAR+$myear) eq "189" && $mmonth eq 6){
			&MAP_LOG2("<img src=$IMG/j19.gif> [189년 6월]소녕(昭寧) 개원. 대장군 하진(何進), 동태후(董太后)를 살해.");
		}
		if(($F_YEAR+$myear) eq "189" && $mmonth eq "9"){
			&MAP_LOG2("<img src=$IMG/j19.gif> [189년 9월]영한(永漢) 개원. 동탁(董卓), 소제를 폐하고 헌제(獻帝) 유협(劉協) 옹립.");
		}
		if(($F_YEAR+$myear) eq "190" && $mmonth eq "9"){
			&MAP_LOG2("<img src=$IMG/j19.gif> [190년 9월]초평(初平) 개원. 동탁 토벌 제후연합군 결성. 동탁, 장안(長安)으로 천도.");
		}
		if(($F_YEAR+$myear) eq "191" && $mmonth eq "1"){
			&MAP_LOG2("<img src=$IMG/j19.gif> [191년 1월]제후연합군 해산. 손권, 유표(劉表)와 전투에서 전사. 장남 손책(孫策) 계승.");
		}
		if(($F_YEAR+$myear) eq "192" && $mmonth eq "1"){
			&MAP_LOG2("<img src=$IMG/j19.gif> [192년 1월]여포(呂布), 왕윤(王允)의 계략에 걸려 동탁을 살해.");
		}
		if(($F_YEAR+$myear) eq "193" && $mmonth eq "1"){
			&MAP_LOG2("<img src=$IMG/j19.gif> [193년 1월]조조의 부친 조숭(曹崇), 도겸(陶謙)의 부하에게 피살.");
		}
		if(($F_YEAR+$myear) eq "194" && $mmonth eq "9"){
			&MAP_LOG2("<img src=$IMG/j19.gif> [194년 9월]흥평(興平) 개원. 도겸이 병사(病死)하자 유비가 서주목(徐州牧)이 됨.");
		}
		if(($F_YEAR+$myear) eq "195" && $mmonth eq "1"){
			&MAP_LOG2("<img src=$IMG/j19.gif> [195년 1월]조조, 여포를 격파함. 여포는 유비에게 의탁.");
		}
		if(($F_YEAR+$myear) eq "196" && $mmonth eq "1"){
			&MAP_LOG2("<img src=$IMG/j19.gif> [196년 1월]건안(建安) 개원. 조조, 헌제를 영접한 후 허(許)로 천도. 유비, 조조에게 투항.");
		}
		if(($F_YEAR+$myear) eq "198" && $mmonth eq "1"){
			&MAP_LOG2("<img src=$IMG/j19.gif> [198년 1월]조조, 여포를 토벌한 후 참수.");
		}
		if(($F_YEAR+$myear) eq "199" && $mmonth eq "1"){
			&MAP_LOG2("<img src=$IMG/j19.gif> [199년 1월]원소, 공손찬(公孫瓚)을 격파하여 하북을 석권. 유비, 조조에게서 탈출.");
		}
		if(($F_YEAR+$myear) eq "200" && $mmonth eq "1"){
			&MAP_LOG2("<img src=$IMG/j19.gif> [200년 1월]조조, 백마(白馬)와 관도(官渡)에서 원소 격파. 손책 사망. 손권(孫權) 승계.");
		}
		if(($F_YEAR+$myear) eq "201" && $mmonth eq "1"){
			&MAP_LOG2("<img src=$IMG/j19.gif> [201년 1월]유비, 유표에게 의탁.");
		}
		if(($F_YEAR+$myear) eq "202" && $mmonth eq "1"){
			&MAP_LOG2("<img src=$IMG/j19.gif> [202년 1월]원소 병사(病死). 작은 아들 원상(袁尙) 승계.");
		}
		if(($F_YEAR+$myear) eq "203" && $mmonth eq "1"){
			&MAP_LOG2("<img src=$IMG/j19.gif> [203년 1월]조조, 원상과 원담(袁譚) 형제 격파.");
		}
		if(($F_YEAR+$myear) eq "204" && $mmonth eq "1"){
			&MAP_LOG2("<img src=$IMG/j19.gif> [204년 1월]조조, 기주(冀州) 평정.");
		}
		if(($F_YEAR+$myear) eq "205" && $mmonth eq "1"){
			&MAP_LOG2("<img src=$IMG/j19.gif> [205년 1월]조조, 원담을 참수. 원상과 원희(袁熙)는 오환족(烏丸族)에게 의탁.");
		}
		if(($F_YEAR+$myear) eq "207" && $mmonth eq "1"){
			&MAP_LOG2("<img src=$IMG/j19.gif> [207년 1월]조조, 오환족 토벌. 오환족이 원상과 원희를 참수.");
		}
		if(($F_YEAR+$myear) eq "208" && $mmonth eq "1"){
			&MAP_LOG2("<img src=$IMG/j19.gif> [208년 1월]유비, 삼고초려(三顧之澧). 제갈량(諸葛亮) 영입. 조조, 적벽대전에서 대패.");
		}
		if(($F_YEAR+$myear) eq "209" && $mmonth eq "1"){
			&MAP_LOG2("<img src=$IMG/j19.gif> [209년 1월]유비, 형주목(荊州牧)이 됨.");
		}
		if(($F_YEAR+$myear) eq "210" && $mmonth eq "1"){
			&MAP_LOG2("<img src=$IMG/j19.gif> [210년 1월]조조, 동작대(銅雀臺) 완공. 12월에 주유(周瑜) 사망.");
		}
		if(($F_YEAR+$myear) eq "211" && $mmonth eq "1"){
			&MAP_LOG2("<img src=$IMG/j19.gif> [211년 1월]유비, 방통(龐統) 영입. 마초(馬超), 거병 후 조조에게 패배. 유비, 입촉(入蜀).");
		}
		if(($F_YEAR+$myear) eq "213" && $mmonth eq "1"){
			&MAP_LOG2("<img src=$IMG/j19.gif> [213년 1월]조조, 위공(魏公) 책봉. 방통, 낙봉파(落鳳坡)에서 전사.");
		}
		if(($F_YEAR+$myear) eq "214" && $mmonth eq "1"){
			&MAP_LOG2("<img src=$IMG/j19.gif> [214년 1월]유비, 성도(成都) 점령. 손권, 유비에게 형주 반환 요구.");
		}
		if(($F_YEAR+$myear) eq "215" && $mmonth eq "1"){
			&MAP_LOG2("<img src=$IMG/j19.gif> [215년 1월]장로(張魯), 조조에게 투항. 조조, 한중(漢中) 평정.");
		}
		if(($F_YEAR+$myear) eq "216" && $mmonth eq "1"){
			&MAP_LOG2("<img src=$IMG/j19.gif> [216년 1월]조조, 위왕(魏王) 책봉.");
		}
		if(($F_YEAR+$myear) eq "219" && $mmonth eq "1"){
			&MAP_LOG2("<img src=$IMG/j19.gif> [219년 1월]유비, 한중왕(漢中王)이 됨. 관우(關羽), 여몽(呂蒙)에게 패하고 참수됨.");
		}
		if(($F_YEAR+$myear) eq "220" && $mmonth eq "1"){
			&MAP_LOG2("<img src=$IMG/j19.gif> [220년 1월]연강(延康) 개원. 조조 사망. 장자 조비(曹丕), 위왕에 즉위.");
		}
		if(($F_YEAR+$myear) eq "220" && $mmonth eq "8"){
			&MAP_LOG2("<img src=$IMG/j19.gif> [220년 8월]황초(黃初 개원. 조비, 헌제 폐하고 황제 즉위. 헌제를 산양공(山陽公)에 봉함.");
		}
		if(($F_YEAR+$myear) eq "221" && $mmonth eq "8"){
			&MAP_LOG2("<img src=$IMG/j19.gif> [221년 8월]8월에 손권을 오왕(吳王)에 봉함.");
		}
		if(($F_YEAR+$myear) eq "221" && $mmonth eq "11"){
			&MAP_LOG2("<img src=$IMG/j19.gif> [221년 11월]장무(章武) 건원(建元). 유비, 황제가 됨. 손권 정벌 개시. 장비(張飛) 피살.");
		}
		if(($F_YEAR+$myear) eq "222" && $mmonth eq "2"){
			&MAP_LOG2("<img src=$IMG/j19.gif> [222년 2월]위나라, 손권 정벌에 나섬.");
		}
		if(($F_YEAR+$myear) eq "222" && $mmonth eq "5"){
			&MAP_LOG2("<img src=$IMG/j19.gif> [222년 5월]유비, 손권군에 대패함.");
		}
		if(($F_YEAR+$myear) eq "222" && $mmonth eq "7"){
			&MAP_LOG2("<img src=$IMG/j19.gif> [222년 7월]황무(黃武) 개원. 손권, 조비에게서 독립할 뜻을 분명히 하고 황무로 개원함.");
		}
		if(($F_YEAR+$myear) eq "223" && $mmonth eq "1"){
			&MAP_LOG2("<img src=$IMG/j19.gif> [223년 1월]건흥(建興) 개원. 유비, 사망. 장자 유선(劉禪) 즉위. 오(吳)와 동맹 체결.");
		}
		if(($F_YEAR+$myear) eq "225" && $mmonth eq "4"){
			&MAP_LOG2("<img src=$IMG/j19.gif> [225년 4월]제갈량, 남정(南征)에 나섬.");
		}
		if(($F_YEAR+$myear) eq "226" && $mmonth eq "6"){
			&MAP_LOG2("<img src=$IMG/j19.gif> [226년 6월]조비, 가복전(嘉福殿)에서 붕어. 태자 조예(曹叡) 즉위.");
		}
		if(($F_YEAR+$myear) eq "227" && $mmonth eq "1"){
			&MAP_LOG2("<img src=$IMG/j19.gif> [227년 1월]위나라, 태화(太和) 개원.");
		}
		if(($F_YEAR+$myear) eq "227" && $mmonth eq "7"){
			&MAP_LOG2("<img src=$IMG/j19.gif> [227년 7월]제갈량, 출사표(出師表)를 올리고 출정. 강유(姜維)를 얻음.");
		}
		if(($F_YEAR+$myear) eq "228" && $mmonth eq "1"){
			&MAP_LOG2("<img src=$IMG/j19.gif> [228년 1월]사마의, 맹달(孟達)을 참수. 가정(街亭)에서 제갈량 격파.");
		}
		if(($F_YEAR+$myear) eq "228" && $mmonth eq "6"){
			&MAP_LOG2("<img src=$IMG/j19.gif> [228년 6월]제갈량 철군. 마속(馬謖) 참수. 조운(趙雲) 사망. 제갈량, 제2차 북벌 출정.");
		}
		if(($F_YEAR+$myear) eq "228" && $mmonth eq "12"){
			&MAP_LOG2("<img src=$IMG/j19.gif> [228년 12월]육손(陸遜), 석정(石亭)에서 조휴(曹休) 격파.");
		}
		if(($F_YEAR+$myear) eq "229" && $mmonth eq "3"){
			&MAP_LOG2("<img src=$IMG/j19.gif> [229년 3월]위나라 종묘(宗廟) 완공.");
		}
		if(($F_YEAR+$myear) eq "229" && $mmonth eq "5"){
			&MAP_LOG2("<img src=$IMG/j19.gif> [229년 5월]황룡(黃龍) 개원. 손권, 황제가 됨. 건업(建業)으로 천도.");
		}
		if(($F_YEAR+$myear) eq "229" && $mmonth eq "9"){
			&MAP_LOG2("<img src=$IMG/j19.gif> [229년 9월]제갈량, 제3차 북벌 시도.");
		}
		if(($F_YEAR+$myear) eq "230" && $mmonth eq "1"){
			&MAP_LOG2("<img src=$IMG/j19.gif> [230년 1월]조비, 조진(曹眞)과 사마의에게 촉나라 토벌 조칙을 내림.");
		}
		if(($F_YEAR+$myear) eq "230" && $mmonth eq "4"){
			&MAP_LOG2("<img src=$IMG/j19.gif> [230년 4월]제갈량 제4차 북벌 시도.");
		}
		if(($F_YEAR+$myear) eq "231" && $mmonth eq "7"){
			&MAP_LOG2("<img src=$IMG/j19.gif> [231년 7월]조진 사망. 제갈량의 북벌 격퇴.");
		}
		if(($F_YEAR+$myear) eq "231" && $mmonth eq "9"){
			&MAP_LOG2("<img src=$IMG/j19.gif> [231년 9월]제갈량, 제5차 북벌 시도.");
		}
		if(($F_YEAR+$myear) eq "232" && $mmonth eq "5"){
			&MAP_LOG2("<img src=$IMG/j19.gif> [232년 5월]오나라, 가화(嘉禾) 개원.");
		}
		if(($F_YEAR+$myear) eq "233" && $mmonth eq "9"){
			&MAP_LOG2("<img src=$IMG/j19.gif> [233년 9월]위나라, 청룡(靑龍) 개원. 공손연(公遜淵), 손권이 파견한 사자를 베어 보내 옴.");
		}
		if(($F_YEAR+$myear) eq "233" && $mmonth eq "1"){
			&MAP_LOG2("<img src=$IMG/j19.gif> [233년 1월]정사 삼국지(三國志)의 저작자 진수(陳壽) 출생.");
		}
		if(($F_YEAR+$myear) eq "233" && $mmonth eq "12"){
			&MAP_LOG2("<img src=$IMG/j19.gif> [233년 12월]오나라, 요동(遼東)의 공손연에게 사자 파견.");
		}
		if(($F_YEAR+$myear) eq "234" && $mmonth eq "10"){
			&MAP_LOG2("<img src=$IMG/j19.gif> [234년 10월]산양공 유협 사망. 사마의, 오장원에서 제갈량 격파.");
		}
		if(($F_YEAR+$myear) eq "234" && $mmonth eq "5"){
			&MAP_LOG2("<img src=$IMG/j19.gif> [234년 5월]제갈량, 제6차 북벌 출정. 8월에 오장원(五丈原)에서 병사.");
		}
		if(($F_YEAR+$myear) eq "235" && $mmonth eq "8"){
			&MAP_LOG2("<img src=$IMG/j19.gif> [235년 8월]사마의, 태위(太尉)가 됨.");
		}
		if(($F_YEAR+$myear) eq "237" && $mmonth eq "5"){
			&MAP_LOG2("<img src=$IMG/j19.gif> [237년 5월]위나라, 경초(景初) 개원. 공손연, 위나라에 반기.");
		}
		if(($F_YEAR+$myear) eq "238" && $mmonth eq "2"){
			&MAP_LOG2("<img src=$IMG/j19.gif> [238년 2월]사마의, 요동으로 출정하여 공손연을 격파하고 참수.");
		}
		if(($F_YEAR+$myear) eq "238" && $mmonth eq "11"){
			&MAP_LOG2("<img src=$IMG/j19.gif> [238년 11월]촉나라, 연희(延熙) 개원.");
		}
		if(($F_YEAR+$myear) eq "238" && $mmonth eq "4"){
			&MAP_LOG2("<img src=$IMG/j19.gif> [238년 4월]오나라, 적오(赤烏) 개원.");
		}
		if(($F_YEAR+$myear) eq "239" && $mmonth eq "3"){
			&MAP_LOG2("<img src=$IMG/j19.gif> [239년 3월]정월 1일, 조예 붕어. 양자 조방(曹芳) 즉위.");
		}
		if(($F_YEAR+$myear) eq "240" && $mmonth eq "11"){
			&MAP_LOG2("<img src=$IMG/j19.gif> [240년 11월]위나라, 정시(正始) 개원.");
		}
		if(($F_YEAR+$myear) eq "245" && $mmonth eq "7"){
			&MAP_LOG2("<img src=$IMG/j19.gif> [245년 7월]관구검(貫丘儉), 고구려(高句驪) 재차 공격.");
		}
		if(($F_YEAR+$myear) eq "245" && $mmonth eq "3"){
			&MAP_LOG2("<img src=$IMG/j19.gif> [245년 3월]육손 사망.");
		}
		if(($F_YEAR+$myear) eq "249" && $mmonth eq "4"){
			&MAP_LOG2("<img src=$IMG/j19.gif> [249년 4월]가평(嘉平) 개원. 사마의가 대장군 조상(曹爽) 일파를 처단. 조정 재집권.");
		}
		if(($F_YEAR+$myear) eq "249" && $mmonth eq "10"){
			&MAP_LOG2("<img src=$IMG/j19.gif> [249년 10월]위나라 장군 하후패(夏侯覇) 촉에 투항. 강유, 제1차 북벌 출정.");
		}
		if(($F_YEAR+$myear) eq "251" && $mmonth eq "2"){
			&MAP_LOG2("<img src=$IMG/j19.gif> [251년 2월]사마의 사망.");
		}
		if(($F_YEAR+$myear) eq "251" && $mmonth eq "6"){
			&MAP_LOG2("<img src=$IMG/j19.gif> [251년 6월]정월, 태원(太元) 개원. 2월, 신봉(神鳳) 개원.");
		}
		if(($F_YEAR+$myear) eq "252" && $mmonth eq "8"){
			&MAP_LOG2("<img src=$IMG/j19.gif> [252년 8월]건흥(建興) 개원. 손권 붕어. 막내 아들 손량(孫亮) 즉위.");
		}
		if(($F_YEAR+$myear) eq "253" && $mmonth eq "6"){
			&MAP_LOG2("<img src=$IMG/j19.gif> [253년 6월]강유, 제2차 북벌 시도.");
		}
}

sub CHARA_MAIN_OPEN {

	open(IN,"./charalog/main/$in{'id'}.cgi") or &ERR2('ID와 패스가 올바르지 않습니다!');
	@CN_DATA = <IN>;
	close(IN);

	($kid,$kpass,$kname,$kchara,$kstr,$kint,$klea,$kcha,$ksol,$kgat,$kcon,$kgold,$krice,$kcex,$kclass,$karm,$kbook,$kbank,$ksub1,$ksub2,$kpos,$kmes,$khost,$kdate,$kmail,$kos,$kskill,$kpoint,$kct,$klevel,$kexp,$kcodea,$kcodeb,$kqpoint) = split(/<>/,$CN_DATA[0]);
	($kstr_ex,$kint_ex,$klea_ex,$kcha_ex,$ksub1_ex,$ksub2_ex,$bo_ex,$gi_ex,$ch_ex,$gu_ex,$go_ex,$jin_ex) = split(/,/,$ksub1);
	if($in{'id'} ne "$kid" or $in{'pass'} ne "$kpass"){&ERR2("ID와 패스가 올바르지 않습니다.");}

}

sub CHARA_MAIN_OPEN_C {

	open(IN,"./charalog/main/$in{'nick'}.cgi") or &ERR2('ID와 패스가 올바르지 않습니다!');
	@CN_DATA = <IN>;
	close(IN);

	($kid,$kpass,$kname,$kchara,$kstr,$kint,$klea,$kcha,$ksol,$kgat,$kcon,$kgold,$krice,$kcex,$kclass,$karm,$kbook,$kbank,$ksub1,$ksub2,$kpos,$kmes,$khost,$kdate,$kmail,$kos,$kskill,$kpoint,$kct,$klevel,$kexp,$kcodea,$kcodeb,$kqpoint) = split(/<>/,$CN_DATA[0]);
	($kstr_ex,$kint_ex,$klea_ex,$kcha_ex,$ksub1_ex,$ksub2_ex,$bo_ex,$gi_ex,$ch_ex,$gu_ex,$go_ex,$jin_ex) = split(/,/,$ksub1);

}

sub CHARA_MAIN_INPUT {

	@NEW_DATA=();
	unshift(@NEW_DATA,"$kid<>$kpass<>$kname<>$kchara<>$kstr<>$kint<>$klea<>$kcha<>$ksol<>$kgat<>$kcon<>$kgold<>$krice<>$kcex<>$kclass<>$karm<>$kbook<>$kbank<>$ksub1<>$ksub2<>$kpos<>$kmes<>$khost<>$kdate<>$kmail<>$kos<>$kskill<>$kpoint<>$kct<>$klevel<>$kexp<>$kcodea<>$kcodeb<>$kqpoint<>\n");
	open(OUT,">./charalog/main/$kid\.cgi") or &ERR('MAIN 새로운 데이터를 기입할 수 없습니다.');
	print OUT @NEW_DATA;
	close(OUT);

}

sub UNIT_OPEN {

	foreach(@UNI_DATA){
	($unit_id,$uunit_name,$ucon,$ureader,$uid)=split(/<>/);
	$u = $unit_id;
	}
}

sub ENEMY_OPEN {

	open(IN,"./charalog/main/$in{'eid'}.cgi") or &ERR2('ID와 패스가 올바르지 않습니다.');
	@E_DATA = <IN>;
	close(IN);
	($eid,$epass,$ename,$echara,$estr,$eint,$elea,$echa,$esol,$egat,$econ,$egold,$erice,$ecex,$eclass,$earm,$ebook,$ebank,$esub1,$esub2,$epos,$emes,$ehost,$edate,$email,$eos,$eskill,$epoint,$ect,$elevel,$eexp,$ecodea,$ecodeb,$eqpoint) = split(/<>/,$E_DATA[0]);
	if($in{'eid'} ne "$eid" ){&ERR2("ID와 패스가 올바르지 않습니다.");}

}

sub ENEMY_INPUT {

	@NEW_DATA=();
	unshift(@NEW_DATA,"$eid<>$epass<>$ename<>$echara<>$estr<>$eint<>$elea<>$echa<>$esol<>$egat<>$econ<>$egold<>$erice<>$ecex<>$eclass<>$earm<>$ebook<>$ebank<>$esub1<>$esub2<>$epos<>$emes<>$ehost<>$edate<>$email<>$eos<>$eskill<>$epoint<>$ect<>$elevel<>$eexp<>$ecodea<>$ecodeb<>$eqpoint<>\n");
	open(OUT,">./charalog/main/$eid\.cgi") or &ERR2('ENEMY 새로운 데이터를 기입할 수 없습니다.');
	print OUT @NEW_DATA;
	close(OUT);

}

sub HISTORY_LOG {

	open(OUT,">>./charalog/history/$_[0]\.cgi");
	print OUT "$old_date: $_[1]\n";
	close(OUT);

}



sub BATTLE_LOG {

	if($lockkey) { &F_LOCK; }
	open(IN,"$BATTLE_LOG_LIST");
	@S_MOVE = <IN>;
	close(IN);

	unshift(@S_MOVE,"$_[0]\n");

	splice(@S_MOVE,150);

	open(OUT,">$BATTLE_LOG_LIST") or &ERR2('LOG 새로운 데이터를 기입할 수 없습니다.');
	print OUT @S_MOVE;
	close(OUT);
	if (-d $lockfile) { &UNLOCK_FILE; }

}


sub MAP_LOG {

	if($lockkey) { &F_LOCK; }
	open(IN,"$MAP_LOG_LIST");
	@S_MOVE = <IN>;
	close(IN);
	&TIME_DATA;

	unshift(@S_MOVE,"$_[0]($mday일$hour시$min분)\n");

	splice(@S_MOVE,20);

	open(OUT,">$MAP_LOG_LIST") or &ERR2('LOG 새로운 데이터를 기입할 수 없습니다.');
	print OUT @S_MOVE;
	close(OUT);
	if (-d $lockfile) { &UNLOCK_FILE; }

}

sub MAP_LOG2 {

	if($lockkey) { &F_LOCK; }
	open(IN,"$MAP_LOG_LIST2");
	@S_MOVE = <IN>;
	close(IN);
	&TIME_DATA;

	unshift(@S_MOVE,"$_[0]($mday일$hour시$min분)\n");

	splice(@S_MOVE,20);

	open(OUT,">$MAP_LOG_LIST2") or &ERR2('LOG 새로운 데이터를 기입할 수 없습니다.');
	print OUT @S_MOVE;
	close(OUT);
	if (-d $lockfile) { &UNLOCK_FILE; }

}

sub MAP_LOG3 {

	if($lockkey) { &F_LOCK; }
	open(IN,"$MAP_LOG_LIST3");
	@S_MOVE = <IN>;
	close(IN);
	&TIME_DATA;

	unshift(@S_MOVE,"$_[0]\n");

	splice(@S_MOVE,20);

	open(OUT,">$MAP_LOG_LIST3") or &ERR2('LOG 새로운 데이터를 기입할 수 없습니다.');
	print OUT @S_MOVE;
	close(OUT);
	if (-d $lockfile) { &UNLOCK_FILE; }

}

sub K_LOG {

	open(IN,"./charalog/log/$kid.cgi");
	@K_LOG = <IN>;
	close(IN);

	unshift(@K_LOG,"$_[0]($mday일$hour시$min분)\n");

	splice(@K_LOG,20);

	open(OUT,">./charalog/log/$kid.cgi");
	print OUT @K_LOG;
	close(OUT);

}


sub ITEM_OPEN {

	open(IN,"$ITEM_LIST") or &ERR('파일을 열지 않았습니다.');
	while(<IN>){
		($id,$name,$rare,$price,$str,$int,$lea,$cha) = split(/<>/,$_);
		$itemname[$id] = $name;
		$itemrare[$id] = $rare;
		$itemprice[$id] = $price;
		$itemstr[$id] = $str;
		$itemint[$id] = $int;
		$itemlea[$id] = $lea;
		$itemcha[$id] = $cha;
	}
	close(IN);
}

sub CHARA_ITEM_OPEN {


	if($kid){
	&COUNTRY_DATA_OPEN("$kcon");

	if($xking eq "$kid" || $x0 eq "$kid"){$kstr2 = int($kstr/20); $kint2 = int($kint/20); $klea2 = int($klea/20); $kcha2=int($kcha/20);}
	elsif($x1 eq "$kid"){$kstr2=int($kstr/10); $klea2=int($klea/10);}
	elsif($x17 eq "$kid"){$kint2=int($kint/10); $kcha2=int($kcha/10);}
	elsif($x2 eq "$kid"){$kstr2=int($kstr/10);}
	elsif($x3 eq "$kid"){$kstr2=int($kstr/15); $klea2=int($klea/15);}
	elsif($x4 eq "$kid"){$klea2=int($klea/10);}
	elsif($x5 eq "$kid" || $x6 eq "$kid" || $x7 eq "$kid" || $x8 eq "$kid"){$kstr2=int($kstr/15);}
	elsif($x9 eq "$kid" || $x10 eq "$kid" || $x11 eq "$kid" || $x12 eq "$kid"){$kstr2=int($kstr/33); $klea2=int($klea/33);}
	elsif($x13 eq "$kid" || $x14 eq "$kid" || $x15 eq "$kid" || $x16 eq "$kid"){$klea2=int($klea/15);}
	elsif($x18 eq "$kid"){$kint2=int($kint/10);}
	elsif($x19 eq "$kid"){$kint2=int($kint/15); $kcha2=int($kcha/15);}
	elsif($x20 eq "$kid"){$kcha2=int($kcha/10);}
	elsif($x21 eq "$kid" || $x22 eq "$kid"){$kint2=int($kint/15);}
	elsif($x23 eq "$kid" || $x24 eq "$kid"){$kint2=int($kint/33); $kcha2=int($kcha/33);}
	elsif($x25 eq "$kid" || $x26 eq "$kid"){$kcha2=int($kcha/15);}
	}

	if($eid){
	&COUNTRY_DATA_OPEN("$econ");

	if($xking eq "$eid" || $x0 eq "$eid"){$estr2 = int($estr/20); $eint2 = int($eint/20); $elea2 = int($elea/20); $echa2=int($echa/20);}
	elsif($x1 eq "$eid"){$estr2=int($estr/10); $elea2=int($elea/10);}
	elsif($x17 eq "$eid"){$eint2=int($eint/10); $echa2=int($echa/10);}
	elsif($x2 eq "$eid"){$estr2=int($estr/10);}
	elsif($x3 eq "$eid"){$estr2=int($estr/15); $elea2=int($elea/15);}
	elsif($x4 eq "$eid"){$elea2=int($elea/10);}
	elsif($x5 eq "$eid" || $x6 eq "$eid" || $x7 eq "$eid" || $x8 eq "$eid"){$estr2=int($estr/15);}
	elsif($x9 eq "$eid" || $x10 eq "$eid" || $x11 eq "$eid" || $x12 eq "$eid"){$estr2=int($estr/33); $elea2=int($elea/33);}
	elsif($x13 eq "$eid" || $x14 eq "$eid" || $x15 eq "$eid" || $x16 eq "$eid"){$elea2=int($elea/15);}
	elsif($x18 eq "$eid"){$eint2=int($eint/10);}
	elsif($x19 eq "$eid"){$eint2=int($eint/15); $echa2=int($echa/15);}
	elsif($x20 eq "$eid"){$echa2=int($echa/10);}
	elsif($x21 eq "$eid" || $x22 eq "$eid"){$eint2=int($eint/15);}
	elsif($x23 eq "$eid" || $x24 eq "$eid"){$eint2=int($eint/33); $echa2=int($echa/33);}
	elsif($x25 eq "$eid" || $x26 eq "$eid"){$echa2=int($echa/15);}
	}

	open(IN,"$ARM_LIST") or &ERR('파일을 열지 않았습니다.');
	@ARM_DATA = <IN>;
	close(IN);
	open(IN,"$PRO_LIST") or &ERR('파일을 열지 않았습니다.');
	@PRO_DATA = <IN>;
	close(IN);

	($karmname,$karmval,$karmstr,$karmlea,$karmint,$karmcha,$karmclass,$karmtownid) = split(/<>/,$ARM_DATA[$karm]);
	($kproname,$kproval,$kprostr,$kprolea,$kproint,$kprocha,$kproclass,$kprotownid) = split(/<>/,$PRO_DATA[$kbook]);
	if($eid){
		($earmname,$earmval,$earmstr,$earmlea,$earmint,$earmcha,$earmclass,$earmtownid) = split(/<>/,$ARM_DATA[$earm]);
		($eproname,$eproval,$eprostr,$eprolea,$eproint,$eprocha,$eproclass,$eprotownid) = split(/<>/,$PRO_DATA[$ebook]);
}
	if($go_ex < 500){
	$kstrt = $kstr2 + $karmstr + $kprostr + $kstr;
	$kleat = $klea2 + $karmlea + $kprolea + $klea;
	$kintt = $kint2 + $karmint + $kproint + $kint;
	$kchat = $kcha2 + $karmcha + $kprocha + $kcha;
	}elsif($go_ex <1000 && $go_ex > 499){
	$kstrt = int(($kstr2 + $karmstr + $kprostr + $kstr) * 0.9);
	$kleat = int(($klea2 + $karmlea + $kprolea + $klea) * 0.9);
	$kintt = int(($kint2 + $karmint + $kproint + $kint) * 0.9);
	$kchat = int(($kcha2 + $karmcha + $kprocha + $kcha) * 0.9);
	}elsif($go_ex < 1250 && $go_ex > 999){
	$kstrt = int(($kstr2 + $karmstr + $kprostr + $kstr) * 0.8);
	$kleat = int(($klea2 + $karmlea + $kprolea + $klea) * 0.8);
	$kintt = int(($kint2 + $karmint + $kproint + $kint) * 0.8);
	$kchat = int(($kcha2 + $karmcha + $kprocha + $kcha) * 0.8);
	}elsif($go_ex < 1500 && $go_ex > 1249){
	$kstrt = int(($kstr2 + $karmstr + $kprostr + $kstr) * 0.7);
	$kleat = int(($klea2 + $karmlea + $kprolea + $klea) * 0.7);
	$kintt = int(($kint2 + $karmint + $kproint + $kint) * 0.7);
	$kchat = int(($kcha2 + $karmcha + $kprocha + $kcha) * 0.7);
	}elsif($go_ex <1750 && $go_ex > 1499){
	$kstrt = int(($kstr2 + $karmstr + $kprostr + $kstr) * 0.5);
	$kleat = int(($klea2 + $karmlea + $kprolea + $klea) * 0.5);
	$kintt = int(($kint2 + $karmint + $kproint + $kint) * 0.5);
	$kchat = int(($kcha2 + $karmcha + $kprocha + $kcha) * 0.5);
	}


	if($ego_ex < 500){
	$estrt = $estr2 + $earmstr + $eprostr + $estr;
	$eleat = $elea2 + $earmlea + $eprolea + $elea;
	$eintt = $eint2 + $earmint + $eproint + $eint;
	$echat = $echa2 + $earmcha + $eprocha + $echa;
	}elsif($ego_ex <1000 && $ego_ex > 499){
	$estrt = int(($estr2 + $earmstr + $eprostr + $estr) * 0.9);
	$eleat = int(($elea2 + $earmlea + $eprolea + $elea) * 0.9);
	$eintt = int(($eint2 + $earmint + $eproint + $eint) * 0.9);
	$echat = int(($echa2 + $earmcha + $eprocha + $echa) * 0.9);
	}elsif($ego_ex < 1250 && $ego_ex > 999){
	$estrt = int(($estr2 + $earmstr + $eprostr + $estr) * 0.8);
	$eleat = int(($elea2 + $earmlea + $eprolea + $elea) * 0.8);
	$eintt = int(($eint2 + $earmint + $eproint + $eint) * 0.8);
	$echat = int(($echa2 + $earmcha + $eprocha + $echa) * 0.8);
	}elsif($ego_ex < 1500 && $ego_ex > 1249){
	$estrt = int(($estr2 + $earmstr + $eprostr + $estr) * 0.7);
	$eleat = int(($elea2 + $earmlea + $eprolea + $elea) * 0.7);
	$eintt = int(($eint2 + $earmint + $eproint + $eint) * 0.7);
	$echat = int(($echa2 + $earmcha + $eprocha + $echa) * 0.7);
	}elsif($ego_ex <1750 && $ego_ex > 1499){
	$estrt = int(($estr2 + $earmstr + $eprostr + $estr) * 0.5);
	$eleat = int(($elea2 + $earmlea + $eprolea + $elea) * 0.5);
	$eintt = int(($eint2 + $earmint + $eproint + $eint) * 0.5);
	$echat = int(($echa2 + $earmcha + $eprocha + $echa) * 0.5);
	}

}

sub TIME_DATA {
	$tt = time ;
	($sec,$min,$hour,$mday,$mon,$year,$wday,$yday) = localtime(time);
	$mon++;
	$ww = (Sun,Mon,Tue,Wed,Thu,Fri,Sat)[$wday];
	$daytime = sprintf("%02d\/%02d\/(%s) %02d:%02d", $mon,$mday,$ww,$hour,$min);
}

sub COUNTRY_DATA_OPEN {

	open(IN,"$COUNTRY_LIST") or &ERR2('파일을 열지 않았습니다. err no :country');
	@COU_DATA = <IN>;
	close(IN);
	$country_no=0;$hit=0;
	foreach(@COU_DATA){
		($xcid,$xname,$xele,$xmark,$xking,$xmes,$xsub,$xpri,$xch)=split(/<>/);
		if("$_[0]" eq "$xcid"){$hit=1;last;}
		$country_no++;
	}

	if(!$hit){
		$xcid=0;
		$xname="재야";
		$xele=0;
		$xmark=0;
		$xking="";
		$xmes=0;
		$xsub=0;
		$xpri=0;
	}
	($x0,$x1,$x2,$x3,$x4,$x5,$x6,$x7,$x8,$x9,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x20,$x21,$x22,$x23,$x24,$x25,$x26,$xxsub1,$xxsub2)= split(/,/,$xsub);

	foreach(@COU_DATA){
		($x2cid,$x2name,$x2ele,$x2mark)=split(/<>/);
		$cou_name[$x2cid] = "$x2name";
		$cou_ele[$x2cid] = "$x2ele";
		$cou_mark[$x2cid] = "$x2mark";
	}
}

sub COUNTRY_DATA_INPUT {

	if($lockkey) { &F_LOCK; }

	if("$xcid" ne "0" && "$xcid" ne ""){
		splice(@COU_DATA,$country_no,1,"$xcid<>$xname<>$xele<>$xmark<>$xking<>$xmes<>$xsub<>$xpri<>$xch<>\n");
		open(OUT,">$COUNTRY_LIST") or &ERR('COUNTRY 데이터를 기입할 수 없습니다.');
		print OUT @COU_DATA;
		close(OUT);
	}

	$s_i = int(rand(5));
	if($s_i eq "0" && $xcid ne ""){
		open(OUT,">$COUNTRY_LIST2") or &ERR('COUNTRY2 새로운 데이터를 기입할 수 없습니다.');
		print OUT @COU_DATA;
		close(OUT);
	}
	if (-d $lockfile) { &UNLOCK_FILE; }

}

sub TOWN_DATA_OPEN {

	open(IN,"$TOWN_LIST") or &ERR("지정된 파일이 열리지 않습니다.");
	@TOWN_DATA = <IN>;
	close(IN);
	$zid = $_[0];
	($zname,$zcon,$znum,$znou,$zsyo,$zshiro,$znou_max,$zsyo_max,$zshiro_max,$zpri,$zx,$zy,$zsouba,$zdef_att,$zsub1,$zsub2,$z[0],$z[1],$z[2],$z[3],$z[4],$z[5],$z[6],$z[7],$zname1,$zname2,$zbong1,$zbong2,$zbong3)=split(/<>/,$TOWN_DATA[$_[0]]);

	if($zname eq ""){&ERR("그 거리는 존재하지 않습니다.");}

	$zc=0;
	foreach(@TOWN_DATA){
		($z2name,$z2con,$z2num,$z2nou,$z2syo)=split(/<>/);
		$town_name[$zc] = "$z2name";
		$town_cou[$zc] = "$z2con";
		$town_get[$z2con] += 1;
		$town_num[$z2con] += $z2num;
		$town_nou[$z2con] += $z2nou;
		$town_syo[$z2con] += $z2syo;
		$zc++;
	}

}

sub TOWN_DATA_INPUT {

	if($lockkey) { &F_LOCK; }

	if("$zname" ne ""){
		splice(@TOWN_DATA,$zid,1,"$zname<>$zcon<>$znum<>$znou<>$zsyo<>$zshiro<>$znou_max<>$zsyo_max<>$zshiro_max<>$zpri<>$zx<>$zy<>$zsouba<>$zdef_att<>$zsub1<>$zsub2<>$z[0]<>$z[1]<>$z[2]<>$z[3]<>$z[4]<>$z[5]<>$z[6]<>$z[7]<>$zname1<>$zname2<>$zbong1<>$zbong2<>$zbong3<>\n");
		open(OUT,">$TOWN_LIST") or &ERR('TOWN 데이터를 기입할 수 없습니다.');
		print OUT @TOWN_DATA;
		close(OUT);
	}

	$s_it = int(rand(3));
	if($s_it eq "0" && $zname ne ""){
		open(OUT,">$TOWN_LIST2") or &ERR('TOWN2 새로운 데이터를 기입할 수 없습니다.');
		print OUT @TOWN_DATA;
		close(OUT);
	}
	if (-d $lockfile) { &UNLOCK_FILE; }
}

sub DECODE {

	if ($ENV{'REQUEST_METHOD'} eq "POST") {
		if ($ENV{'CONTENT_LENGTH'} > 51200) { &ERR("글자 수가 너무 많습니다!"); }
		read(STDIN, $buffer, $ENV{'CONTENT_LENGTH'});
	} else { $buffer = $ENV{'QUERY_STRING'}; }
	@pairs = split(/&/, $buffer);

	$v=0;
	foreach (@pairs) {
		($name,$value) = split(/=/, $_);
		$value =~ tr/+/ /;
		$value =~ s/%([a-fA-F0-9][a-fA-F0-9])/pack("C", hex($1))/eg;

		$value =~ s/</&lt;/g;
		$value =~ s/>/&gt;/g;
		$value =~ s/\"/&quot;/g;

		if ($name eq "ins" || $name eq "qtalka1" || $name eq "qtalkb1" || $name eq "qtalkc1") {
			$value =~ s/\r\n/<br>/g;
			$value =~ s/\r/<br>/g;
			$value =~ s/\n/<br>/g;
		} else {
			$value =~ s/\r//g;
			$value =~ s/\n//g;
		}

		if($name eq 'no'){
			$no[$v] = $value;
			$v++;
			$in{$name} = $value;
		}else{
			$in{$name} = $value;
		}
	}
	$mode = $in{'mode'};
	$in{'url'} =~ s/^http\:\/\///;
	$cookie_pass = $in{'pass'};
	$cookie_id = $in{'id'};
}

sub HOST_NAME {
	$host = $ENV{'REMOTE_HOST'};
	$addr = $ENV{'REMOTE_ADDR'};

	if ($get_remotehost) {
		if ($host eq "" || $host eq "$addr") {
			$host = gethostbyaddr(pack("C4", split(/\./, $addr)), 2);
		}
	}
	if ($host eq "") { $host = $addr; }


}

sub ERR {

	&CHARA_MAIN_OPEN;
	&HEADER;
	if (-d $lockfile) { &UNLOCK_FILE; }
	print "<center><hr size=0><h3>ERROR !</h3>\n";
	print "<P><font color=red><B>$_[0]</B></font>\n";
print "<form action=\"$FILE_STATUS\" method=\"post\"><input type=hidden name=id value=$kid><input type=hidden name=pass value=$kpass><input type=hidden name=mode value=STATUS><input type=submit value=\"돌아온다\"></form>";
	print "<P><hr size=0></center>\n</body></html>\n";
	exit;
}


sub EVENT_MSG {

	&CHARA_MAIN_OPEN;
	&HEADER;
	if (-d $lockfile) { &UNLOCK_FILE; }
	print "<center><hr size=0><h3>ERROR !</h3>\n";
	print "<P><font color=red><B>$_[0]</B></font>\n";
print "<form action=\"./event.cgi\" method=\"post\"><input type=hidden name=id value=$kid><input type=hidden name=pass value=$kpass><input type=submit value=\"돌아온다\"></form>";
	print "<P><hr size=0></center>\n</body></html>\n";
	exit;
}


sub ERR2 {

	&HEADER;
	if (-d $lockfile) { &UNLOCK_FILE; }
	print "<center><hr size=0><h3>ERROR !</h3>\n";
	print "<P><font color=red><B>$_[0]</B></font>\n";
	print "<P><hr size=0></center>\n</body></html>\n";
	exit;
}

sub F_LOCK {

	$qhit=0;
	for($qp=0;$qp<1;$qp++){
		if (-d $lockfile) {
			$qhit=1;
			sleep(1);
			last;
 		}else{
			mkdir($lockfile, 0755);
		}
	}

	if($qhit){
     	&UNLOCK_FILE();
	 	&ERR("File lock error!<BR>파일 갱신중입니다. 잠시만 기다려 주세요.");
	}

}

sub UNLOCK_FILE
{
  rmdir("$lockfile");
}

sub HEADER {

	$kstr1 = int($kstr/2);
	$kint1 = int($kint/2);
	$klea1 = int($klea/2);
	$kcha1 = int($kcha/2);
	$kgold1 = int($kgold/500);
	$krice1 = int($krice/500);
	$kcex1 = int($kcex/150);
	$ksol1 = int($ksol/30);

	print "Cache-Control: no-cache\n";
	print "Pragma: no-cache\n";
	print "Content-type: text/html\n\n";
	print <<"EOM";
<html>
<script language="javascript">
function info(id){
window.open("chara.cgi?id="+id,"","width=256,height=214,scrollbars=1,menubar=0,toolbar=0,status=0,location=0,directories=0");
}
</script>

<head>
<META HTTP-EQUIV="Content-type" CONTENT="text/html; charset=euc-kr">
EOM
	print <<"EOM";
<STYLE type="text/css">
<!--
BODY,TR,TD,TH{
font-family : "돋움체";
font-size: $FONT_SIZE
}
A:HOVER{
 color: $ALINK
}
.S1 {color:#fff; border-style: double; border-width: 3px;BACKGROUND: #633;}
.dmg { color: #FF0000; font-size: 18pt }
.clit { color: #0000FF; font-size: 18pt }
.r { color: #FF4444; font-size: 10pt }
.b { color: #4444DD; font-size: 10pt }
.s { color: #44AAEE; font-size: 10pt }
.g { color: #44DD44; font-size: 10pt }
.o { color: #EEAA44; font-size: 10pt }
-->
</STYLE>
<title>$GAME_TITLE</title></head>
<body background="$BACKGROUND" bgcolor="$BGCOLOR" text="$TEXT" link="$LINK" vlink="$VLINK" alink="$ALINK" leftmargin="0" marginwidth="0" marginheight="0">
EOM


}

sub HEADER1 {

	$kstr1 = int($kstr/2);
	$kint1 = int($kint/2);
	$klea1 = int($klea/2);
	$kcha1 = int($kcha/2);
	$kgold1 = int($kgold/500);
	$krice1 = int($krice/500);
	$kcex1 = int($kcex/150);
	$ksol1 = int($ksol/30);

	print "Cache-Control: no-cache\n";
	print "Pragma: no-cache\n";
	print "Content-type: text/html\n\n";
	print <<"EOM";
<html>
<script language="javascript">
function info(id){
window.open("chara.cgi?id="+id,"","width=256,height=214,scrollbars=1,menubar=0,toolbar=0,status=0,location=0,directories=0");
}
</script>
<script language="javascript">
function avatar(id){
window.open("avatar.cgi?id="+id,"","width=60,height=80,scrollbars=1,menubar=0,toolbar=0,status=0,location=0,directories=0");
}
</script>
<head>
<META HTTP-EQUIV="Content-type" CONTENT="text/html; charset=euc-kr">
EOM
	print <<"EOM";
<STYLE type="text/css">
<!--
BODY,TR,TD,TH{
font-family : "돋움체";
font-size: $FONT_SIZE
}
A:HOVER{
 color: $ALINK
}
.S1 {color:#fff; border-style: double; border-width: 3px;BACKGROUND: #633;}
.dmg { color: #FF0000; font-size: 18pt }
.clit { color: #0000FF; font-size: 18pt }
.r { color: #FF4444; font-size: 10pt }
.b { color: #4444DD; font-size: 10pt }
.s { color: #44AAEE; font-size: 10pt }
.g { color: #44DD44; font-size: 10pt }
.o { color: #EEAA44; font-size: 10pt }
-->
</STYLE>
<title>$GAME_TITLE</title></head>
<body background="$IMG/backg.gif" bgcolor="$BGCOLOR" text="$TEXT" link="$LINK" vlink="$VLINK" alink="$ALINK" leftmargin="0" marginwidth="0" marginheight="0">
EOM


}


sub GET_COOKIE {
	@pairs = split(/;/, $ENV{'HTTP_COOKIE'});
	foreach (@pairs) {
		local($key,$val) = split(/=/);
		$key =~ s/\s//g;
		$GET{$key} = $val;
	}
	@pairs = split(/,/, $GET{'WOR'});
	foreach (@pairs) {
		local($key,$val) = split(/<>/);
		$COOK{$key} = $val;
	}
	$_id  = $COOK{'id'};
	$_pass = $COOK{'pass'};
}

sub SET_COOKIE {

	local($sec,$min,$hour,$mday,$mon,$year,$wday) = gmtime(time+60*24*60*60);
	@month=('Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec');
	$gmt = sprintf("%s, %02d-%s-%04d %02d:%02d:%02d GMT",
			$week[$wday],$mday,$month[$mon],$year+1900,$hour,$min,$sec);
	$cook="id<>$cookie_id\,pass<>$cookie_pass";
	print "Set-Cookie: WOR=$cook; expires=$gmt\n";
}

sub MAKE_GUEST_LIST {

	if($lockkey) { &F_LOCK; }
	open(GUEST,"$GUEST_LIST") or &ERR2('파일을 열지 않았습니다.');
	@GUEST=<GUEST>;close(GUEST);

	$times = time();@m_list = ();$hit=0;@New_guest_list=();

	foreach (@GUEST){($timer,$name,$con,$opos) = split(/<>/);
		if( $times - 180 > $timer){
			next;
		}elsif($kname eq $name){
			if( $times - 0 <= $timer){ &ERR("전회 갱신하고 나서 10초 이상 경과하지 않았습니다.<BR>간격을 열어 실행해 주세요."); }
			push (@New_guest_list,"$times<>$kname<>$kcon<>$kpos<>\n");
			$m_list .= "<a href=\"javascript:info('$kid')\">$kname</a>\[$town_name[$kpos]\] ";
			$hit = 1;
		}else{
			push (@New_guest_list,"$timer<>$name<>$con<>$opos<>\n");
			if($kcon eq $con){
				$m_list .= "$name\[$town_name[$opos]\] ";
			}
		}
	}

	if(!$hit){
		push(@New_guest_list,"$times<>$kname<>$kcon<>$kpos<>\n");
		$m_list .= "$kname\[$town_name[$kpos]\] ";
	}

	open(GUEST,">$GUEST_LIST") or &ERR('파일을 열지 않았습니다.');
	print GUEST @New_guest_list;close(GUEST);
	if (-d $lockfile) { &UNLOCK_FILE; }
}


sub EVENT_TIME_LIST {

	if($lockkey) { &F_LOCK; }
	open(GUEST1,"./log_file/event_time.cgi") or &ERR2('파일을 열지 않았습니다.');
	@GUEST1=<GUEST1>;close(GUEST1);

	$times = time();@m_list = ();$hit=0;@New_event_list=();

	foreach (@GUEST1){($timer,$name,$con,$opos) = split(/<>/);
		if($kname eq $name){
			$limit_time = 60 - ($times - $timer);
			if( $times - 60 <= $timer){ &EVENT_MSG("다시 재대결을 하기 위해서는 1분을 기다려야 합니다.<br>남은시간 : $limit_time초"); }
			push (@New_event_list,"$times<>$kname<>$kcon<>$kpos<>\n");
			$hit = 1;
		}else{
			push (@New_event_list,"$timer<>$name<>$con<>$opos<>\n");
		}
	}

	if(!$hit){
		push(@New_event_list,"$times<>$kname<>$kcon<>$kpos<>\n");
	}

	open(GUEST1,">./log_file/event_time.cgi") or &ERR('파일을 열지 않았습니다.');
	print GUEST1 @New_event_list;close(GUEST1);
	if (-d $lockfile) { &UNLOCK_FILE; }
}

sub K_LOG3 {

	open(IN,"./charalog/log2/$kid.cgi");
	@K_LOG3 = <IN>;
	close(IN);

	unshift(@K_LOG3,"$_[0]\n");

	splice(@K_LOG3,20);

	open(OUT,">./charalog/log2/$kid.cgi");
	print OUT @K_LOG3;
	close(OUT);

}

sub E_LOG3 {
	if($eid ne ""){
		open(IN,"./charalog/log2/$eid\.cgi");
		@E_LOG3 = <IN>;
		close(IN);
		unshift(@E_LOG3,"$_[0]\n");
		splice(@E_LOG3,20);

		open(OUT,">./charalog/log2/$eid\.cgi");
		print OUT @E_LOG3;
		close(OUT);
	}
}

sub K_LOG4 {

	open(IN,"./charalog/log3/$kid.cgi");
	@K_LOG4 = <IN>;
	close(IN);

	unshift(@K_LOG4,"$_[0]\n");

	splice(@K_LOG4,20);

	open(OUT,">./charalog/log3/$kid.cgi");
	print OUT @K_LOG4;
	close(OUT);

}

sub E_LOG4 {
	if($eid ne ""){
		open(IN,"./charalog/log3/$eid\.cgi");
		@E_LOG4 = <IN>;
		close(IN);
		unshift(@E_LOG4,"$_[0]\n");
		splice(@E_LOG4,20);

		open(OUT,">./charalog/log3/$eid\.cgi");
		print OUT @E_LOG4;
		close(OUT);
	}
}

sub SERVER_STOP {

	&HOST_NAME;
	open(GUEST,"./log_file/stop.cgi") or &ERR2('파일을 열지 않았습니다.');
	@STOP=<GUEST>;close(GUEST);
if($host eq ""){&ERR("호스트명을 유효하게 해주세요.");}
	$times = time();@m_list = ();$hit=0;@New_stop=();
	$phit=0;
	foreach (@STOP){
		($stimer,$shost) = split(/<>/);
		if( $times - 180 > $stimer){
			next;
		}elsif($shost eq $host){
			if( $times-5 <= $stimer){
				$phit = 1;
			}
			push (@New_stop,"$times<>$host<>\n");
			$hit = 1;
		}else{
			push (@New_stop,"$stimer<>$shost<>\n");
		}
	}


	if(!$hit){
		push(@New_stop,"$times<>$host<>\n");
	}

	open(GUEST,">./log_file/stop.cgi") or &ERR('파일을 열지 않았습니다.');
	print GUEST @New_stop;close(GUEST);

	if($phit){
		if($in{'id'} eq ""){
#			&ERR2("서버의 부하 방지를 위해 갱신하고 나서<BR>5초 이상 간격을 열어 실행해 주세요.<BR>Your host name : $host");
		}else{
#			&ERR("서버의 부하 방지를 위해 갱신하고 나서<BR>5초 이상 간격을 열어 실행해 주세요.<BR>Your host name : $host");
		}
	}

}


1;
